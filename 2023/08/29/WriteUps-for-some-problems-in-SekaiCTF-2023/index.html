<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>WriteUps for some problems in SekaiCTF-2023 | Photon’s Blog</title><meta name="keywords" content="pwn,reverse,writeup"><meta name="author" content="Photon"><meta name="copyright" content="Photon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="last weekend , I take part in the SekaiCTF-2023 and solve some easy challenges.On the last day night, I spend most of time on the challenge called Sahuang Flag Checker.I get the main algorithms by rev">
<meta property="og:type" content="article">
<meta property="og:title" content="WriteUps for some problems in SekaiCTF-2023">
<meta property="og:url" content="http://phot0n.com/2023/08/29/WriteUps-for-some-problems-in-SekaiCTF-2023/index.html">
<meta property="og:site_name" content="Photon’s Blog">
<meta property="og:description" content="last weekend , I take part in the SekaiCTF-2023 and solve some easy challenges.On the last day night, I spend most of time on the challenge called Sahuang Flag Checker.I get the main algorithms by rev">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg">
<meta property="article:published_time" content="2023-08-29T03:54:14.000Z">
<meta property="article:modified_time" content="2023-08-30T12:32:42.957Z">
<meta property="article:author" content="Photon">
<meta property="article:tag" content="pwn">
<meta property="article:tag" content="reverse">
<meta property="article:tag" content="writeup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg"><link rel="shortcut icon" href="/img/20170202211516_4B3nj.thumb.1000_0.jpeg"><link rel="canonical" href="http://phot0n.com/2023/08/29/WriteUps-for-some-problems-in-SekaiCTF-2023/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'WriteUps for some problems in SekaiCTF-2023',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-30 20:32:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"> <script src="/live2d-widget/autoload.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Photon’s Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2022/01/19/K4TwFgDxsJ62tEo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">55</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">32</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Photon’s Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">WriteUps for some problems in SekaiCTF-2023</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-08-29T03:54:14.000Z" title="Created 2023-08-29 11:54:14">2023-08-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-08-30T12:32:42.957Z" title="Updated 2023-08-30 20:32:42">2023-08-30</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">4.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>29min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>last weekend , I take part in the SekaiCTF-2023 and solve some easy challenges.On the last day night, I spend most of time on the challenge called <code>Sahuang Flag Checker</code>.I get the main algorithms by reversing,but for some reason I overthink the problem and didn’t realize that It’s just a simple problem :(</p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="Sahuang-Flag-Checker"><a href="#Sahuang-Flag-Checker" class="headerlink" title="Sahuang Flag Checker"></a>Sahuang Flag Checker</h2><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p><img src="https://s2.loli.net/2023/08/30/SIg78FqUCPTpLsn.png" alt="image-20230830202624565"></p>
<h3 id="Emulate"><a href="#Emulate" class="headerlink" title="Emulate"></a>Emulate</h3><p>To run this file,your cpu need to support AVX-512.Or you will get some info like <code>illegal instruction</code> .I try 3 methods to run it. First I try to use <code>unicorn</code> to emulate it , but It seems it don’t support AVX-512 too.(Although I find the info on the github issue page of unicorn,ones say that it support AVX-512.but , any way , I can’t run it.If some one know how to use it , please tell me)</p>
<p><img src="https://s2.loli.net/2023/08/29/pUJDSlNuYzgkOx9.png" alt="image-20230829174051968"></p>
<p>later I try to use <code>QEMU</code> to run this binary , but I can’t find some guide to tell me how to support AVX-512 on QEMU . While I  find the same question on <code>stackoverflow</code> ,and says that the tools called <code>SDE</code> may help. So I download this tools and find I can’t run it. I get the error info like <code>SDE ERROR: Could not find base path for</code>.Change the environment variables didn’t help. I search a lot but can solve it.Yep , I didnt notice the file called <code>sde64</code> (f**k ),and It can run.When I can run the binary,I only got 3 hours left. :(</p>
<p>You can launch two terminal, one run this command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sde-external-9.24.0-2023-07-13-lin/sde64 -icl -debug --  ./sahuang</span><br></pre></td></tr></table></figure>
<p>it will tell you the post (info like</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Start GDB, then issue this command at the (gdb) prompt:</span><br><span class="line">  target remote :60633</span><br></pre></td></tr></table></figure>
<p> )</p>
<p>and one run gdb-multiarch to connect.</p>
<p>I don’t know why,My pwndbg and gef failed to work.So I can only use the primary gdb to debug it. It’s painful</p>
<h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><p>It is clear that in this part,the file sacnf the flag string and pad it to 16-byte.It is stored in v31.</p>
<p> <img src="https://s2.loli.net/2023/08/29/wKqYzAco8kI7eS9.png" alt="image-20230829175502662"></p>
<p>And ,in this part, It handle the flag string 16 bytes by 16 bytes (My English is pool, I want to express that it handle the first 16 bytes and the next 16bytes, and so on)</p>
<p>On each cycle, firstly the flag string to be handled is passed to a function called <code>rc</code> and stored in <code>v28</code>.</p>
<p>And <code>v28</code> is passed to <code>matmult_SSE4</code> (It may relative to matrix mult judged by its function name.I debug it in case the author change something in the matrix mult funciton.) and the result is stored in v29</p>
<p>Later,  after two <code>mul</code> and one <code>sub</code> and one <code>add</code> ,the flag string is changed to something like ciphertext.</p>
<p>We need to recover the flag by the ciphertext</p>
<p><img src="https://s2.loli.net/2023/08/29/trSbF5G3gcuYmWQ.png" alt="image-20230829175714938"></p>
<h4 id="rc"><a href="#rc" class="headerlink" title="rc"></a>rc</h4><p>first ,Let ‘ s analysis the function called <code>rc</code> .I analysis it staticly.Actually,it has a lot of junk code.And in function <code>mul</code> and function <code>sub</code> and function <code>add</code>,there are a lot of junk code of the same style like this.</p>
<p>It receive two parameter, one <code>char</code> and one <code>int</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">rc</span><span class="params">(<span class="keyword">char</span> a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v41; <span class="comment">// [rsp+8h] [rbp-130h]</span></span><br><span class="line">  <span class="keyword">char</span> v42; <span class="comment">// [rsp+9h] [rbp-12Fh]</span></span><br><span class="line">  <span class="keyword">char</span> v43; <span class="comment">// [rsp+Ah] [rbp-12Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v44; <span class="comment">// [rsp+Bh] [rbp-12Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v45; <span class="comment">// [rsp+10h] [rbp-128h]</span></span><br><span class="line">  <span class="keyword">int</span> v46; <span class="comment">// [rsp+14h] [rbp-124h]</span></span><br><span class="line"></span><br><span class="line">  v44 = a1;</span><br><span class="line">  __asm</span><br><span class="line">  &#123;</span><br><span class="line">    vpbroadcastb xmm0, [rbp+var_12D]</span><br><span class="line">    vmovdqa [rbp+var_120], xmm0</span><br><span class="line">  &#125;</span><br><span class="line">  v43 = <span class="number">0xF0</span>;</span><br><span class="line">  __asm</span><br><span class="line">  &#123;</span><br><span class="line">    vpbroadcastb xmm0, [rbp+var_12E]</span><br><span class="line">    vmovdqa xmm1, xmm0</span><br><span class="line">    vmovdqa xmm0, [rbp+var_120]</span><br><span class="line">    vmovdqa [rbp+var_20], xmm0</span><br><span class="line">    vmovdqa [rbp+var_10], xmm1</span><br><span class="line">    vmovdqa xmm1, [rbp+var_20]</span><br><span class="line">    vmovdqa xmm0, [rbp+var_10]</span><br><span class="line">    vpand   xmm0, xmm1, xmm0</span><br><span class="line">    vmovdqa [rbp+var_F0], xmm0</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>We notice that the <code>v44</code>(the int parameter we pass in) is stored in <code>[rbp-12Dh]</code> and it store the parameter <code>a1</code>,  In the first asm block, It is passed to <code>xmm0</code> and then stored in <code>[rbp-120h]</code> . In the second asm block,the content in <code>[rbp+var_12E]</code>  (Actually the <code>v43</code>)is passed to <code>xmm0</code> and then passed to <code>xmm1</code>, and the content in <code>[rbp+var_120h]</code>(which is the <code>v44</code>,or the <code>a1</code> we pass) . And we get <code>xmm1 &amp; xmm2</code> by the code <code>vpand   xmm0, xmm1, xmm0</code> . The result is stored in <code>[rbp+var_F0]</code>. So this part we get <code>a1&amp;f0</code> (the highest 4 bit of a1)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> v42; <span class="comment">// [rsp+9h] [rbp-12Fh]  </span></span><br><span class="line">v42 = <span class="number">0xF</span>;</span><br><span class="line">  __asm</span><br><span class="line">  &#123;</span><br><span class="line">    vpbroadcastb xmm0, [rbp+var_12F]</span><br><span class="line">    vmovdqa xmm1, xmm0</span><br><span class="line">    vmovdqa xmm0, [rbp+var_120]</span><br><span class="line">    vmovdqa [rbp+var_40], xmm0</span><br><span class="line">    vmovdqa [rbp+var_30], xmm1</span><br><span class="line">    vmovdqa xmm1, [rbp+var_40]</span><br><span class="line">    vmovdqa xmm0, [rbp+var_30]</span><br><span class="line">    vpand   xmm0, xmm1, xmm0</span><br><span class="line">    vmovdqa [rbp+var_E0], xmm0</span><br><span class="line">    vmovdqa xmm0, [rbp+var_E0]</span><br><span class="line">    vmovdqa [rbp+var_50], xmm0</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Similarly ,we get the <code>a1&amp;0x0f</code> (the lowest 4 bit of a1)and store it in<code>[rbp+var_50]</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> v46; <span class="comment">// [rsp+14h] [rbp-124h]  </span></span><br><span class="line">v46 = <span class="number">4</span> - a2;</span><br><span class="line">  __asm</span><br><span class="line">  &#123;</span><br><span class="line">    vmovdqa xmm0, [rbp+var_50]</span><br><span class="line">    vmovd   xmm1, [rbp+var_124]</span><br><span class="line">    vpsrld  xmm0, xmm0, xmm1</span><br><span class="line">    vmovdqa xmm2, xmm0</span><br><span class="line">    vmovdqa xmm0, [rbp+var_E0]</span><br><span class="line">    vmovdqa [rbp+var_60], xmm0</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>this part, <code>xmm0</code> get the content of <code>[rbp+var_50]</code>(which is <code>a1&amp;0x0f</code> ) and <code>xmm1</code> get the content of <code>[rbp+var_124]</code>(which is <code>v46</code>. It is set to <code>4- a2</code>) .By the code  <code>vpsrld  xmm0, xmm0, xmm1</code> ,we get <code>(a1&amp;0f)&gt;&gt;(4-a2)</code>)and store it in <code>[rbp+var_60]</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> v45; <span class="comment">// [rsp+10h] [rbp-128h]</span></span><br><span class="line">v45 = a2;</span><br><span class="line"> __asm</span><br><span class="line"> &#123;</span><br><span class="line">   vmovdqa xmm0, [rbp+var_60]</span><br><span class="line">   vmovd   xmm1, [rbp+var_128]</span><br><span class="line">   vpslld  xmm0, xmm0, xmm1</span><br><span class="line">   vmovdqa [rbp+var_80], xmm0</span><br><span class="line">   vmovdqa [rbp+var_70], xmm2</span><br><span class="line">   vmovdqa xmm1, [rbp+var_80]</span><br><span class="line">   vmovdqa xmm0, [rbp+var_70]</span><br><span class="line">   vpor    xmm0, xmm1, xmm0</span><br><span class="line">   vmovdqa [rbp+var_C0], xmm0</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>in this part ,like we just analysis ,It first get <code>(((a1&amp;0f)&gt;&gt;(4-a2)))&lt;&lt; a2</code> (By code <code>vpslld  xmm0, xmm0, xmm1</code> ,<code>xmm0</code> is <code>(a1&amp;0f)&gt;&gt;(4-a2)</code> ,<code>xmm1</code> is <code>v45</code>,which is set to a2) and store it in <code>[rbp+var_80]</code></p>
<p>By the code <code>vpor    xmm0, xmm1, xmm0</code>,we get  <code>((((a1&amp;0f)&gt;&gt;(4-a2)))&lt;&lt; a2) | (a1&amp;0f)&gt;&gt;(4-a2)</code> (<code>xmm1</code> is from the result of <code>vpslld</code> we just get, and <code>xmm0</code> ,which is from <code>xmm2</code>  -&gt;from <code>vpsrld  xmm0, xmm0, xmm1</code>  -&gt;<code>(a1&amp;0f)&gt;&gt;(4-a2)</code>)and store it in <code>[rbp+var_C0]</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">char v41; &#x2F;&#x2F; [rsp+8h] [rbp-130h]</span><br><span class="line">v41 &#x3D; 0xF;</span><br><span class="line">__asm</span><br><span class="line">&#123;</span><br><span class="line">  vpbroadcastb xmm0, [rbp+var_130]</span><br><span class="line">  vmovdqa xmm1, xmm0</span><br><span class="line">  vmovdqa xmm0, [rbp+var_C0]</span><br><span class="line">  vmovdqa [rbp+var_100], xmm0</span><br><span class="line">  vmovdqa [rbp+var_110], xmm1</span><br><span class="line">  vmovdqa xmm1, [rbp+var_100]</span><br><span class="line">  vmovdqa xmm0, [rbp+var_110]</span><br><span class="line">  vpand   xmm0, xmm1, xmm0</span><br><span class="line">  vmovdqa xmm1, xmm0</span><br><span class="line">  vmovdqa xmm0, [rbp+var_F0]</span><br><span class="line">  vmovdqa [rbp+var_B0], xmm0</span><br><span class="line">  vmovdqa [rbp+var_D0], xmm1</span><br><span class="line">  vmovdqa xmm0, [rbp+var_B0]</span><br><span class="line">  vmovdqa xmm1, [rbp+var_D0]</span><br><span class="line">  vpor    xmm0, xmm1, xmm0</span><br><span class="line">  vmovdqa [rbp+var_A0], xmm0</span><br><span class="line">  vmovdqa xmm0, [rbp+var_A0]</span><br><span class="line">  vmovdqa [rbp+var_90], xmm0</span><br><span class="line">  vmovdqa xmm0, [rbp+var_90]</span><br><span class="line">  vmovd   eax, xmm0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>just the same way ,we get <code>(((((a1&amp;0f)&gt;&gt;(4-a2)))&lt;&lt; a2) | (a1&amp;0f)&gt;&gt;(4-a2)) &amp;0xf</code> and store it in <code>[rbp+var_D0]</code>,by <code>vpor    xmm0, xmm1, xmm0</code> ,we get <code>((((((a1&amp;0f)&gt;&gt;(4-a2)))&lt;&lt; a2) | (a1&amp;0f)&gt;&gt;a2) &amp;0xf)| (x&amp;0xf0)</code></p>
<p>Actually, if we draw to help us understand ,we could find that it is just a simple switch of bit</p>
<p>if we set a2 to be 3,it may like:a1  -&gt;  [7|6|5|4|3|2|1|0] ,the lowest 4 bit -&gt;[3|2|1|0] ,part 1 we get [3|2|1|0] &gt;&gt;(4-3)&lt;<3 ,which is [3|2|1|0|0|0], part 2 we get  [3|2|1|0]>&gt;(4-1) ,which is [3|2|1] ,and we and them and get [3|2|1|3|2|1] ,and we and 0xf get [1|3|2|1]. last we  or the x&amp;0xf0, finally get [7|6|5|4|1|3|2|1] .It’s just swtich the a2 highest bit of a2’s lowest 4 bit and (4-a2) lowest bit of a2 ‘s  lowest 4 bit</p>
<p>obviously, it’s reversible</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc</span>(<span class="params">x</span>):</span></span><br><span class="line">	<span class="keyword">return</span> ((x&amp;<span class="number">0xf0</span>)|((((x&amp;<span class="number">0xf</span>)&gt;&gt;<span class="number">1</span>)|((x&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">3</span>))&amp;<span class="number">15</span>))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rev_rc</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> ((x&amp;<span class="number">0xf0</span>)|((((x&amp;<span class="number">0xf</span>)&gt;&gt;<span class="number">3</span>)|((x&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">1</span>))&amp;<span class="number">15</span>))</span><br></pre></td></tr></table></figure>
<h4 id="matmult-SSE4"><a href="#matmult-SSE4" class="headerlink" title="matmult_SSE4"></a>matmult_SSE4</h4><p>Next we analysis the function called <code>matmult_SSE4</code> . We will use gdb to debug it and guess something (You can just read the assembly code like above analysis,But it’s not fun)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">matmult_SSE4</span><span class="params">(__int64 ans, __int64 matrix_1, __int64 matrix_2, __m128 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-44h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    lincomb_SSE(((__int64)i &lt;&lt; <span class="number">6</span>) + matrix_1, matrix_2, a3);</span><br><span class="line">    __asm &#123; vmovapd zmmword ptr [rsp+<span class="number">80</span>h+var_40], zmm0 &#125;</span><br><span class="line">    result = ans + ((__int64)i &lt;&lt; <span class="number">6</span>);</span><br><span class="line">    __asm</span><br><span class="line">    &#123;</span><br><span class="line">      vmovapd zmm0, zmmword ptr [rsp+<span class="number">80</span>h+var_40]</span><br><span class="line">      vmovapd zmmword ptr [rax], zmm0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure>
<p>you may think it ‘s a function to mult two matrix subconsciously.But if you notice the function called <code>lincomb_SSE</code>,you may think the <code>matmult_SSE4</code> function is used to mult matrix and vector.After all, the second parameter (which is matrix_2) of  <code>lincomb_SSE</code> don’t change.Apparently, there should be a matrix and a columns vector. And each time the cow of matrix lincomb with the columns vector.You may get the info that the size of  matrix is 32*16(In <code>lincomb_SSE</code> there are 16 times add,and in <code>matmult_SSE4</code>, there are 32 times add.It was natural to think the matrix is 32*16)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">lincomb_SSE</span><span class="params">(__int64 A, __int64 a2, __m128 _XMM0)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+14h] [rbp-1DCh]</span></span><br><span class="line"></span><br><span class="line">  __asm</span><br><span class="line">  &#123;</span><br><span class="line">    vxorpd  xmm0, xmm0, xmm0</span><br><span class="line">    vmovsd  [rsp+<span class="number">188</span>h+var_1D8], xmm0</span><br><span class="line">    vbroadcastsd zmm0, [rsp+<span class="number">188</span>h+var_1D8]</span><br><span class="line">    vmovapd zmmword ptr [rsp+<span class="number">188</span>h+var_1C0], zmm0</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    _RAX = a2 + ((__int64)i &lt;&lt; <span class="number">7</span>);</span><br><span class="line">    __asm</span><br><span class="line">    &#123;</span><br><span class="line">      vmovsd  xmm0, qword ptr [rax]</span><br><span class="line">      vmovsd  [rsp+<span class="number">188</span>h+var_1C8], xmm0</span><br><span class="line">      vbroadcastsd zmm0, [rsp+<span class="number">188</span>h+var_1C8]</span><br><span class="line">      vmovapd zmmword ptr [rsp+<span class="number">188</span>h+var_140], zmm0</span><br><span class="line">    &#125;                                           <span class="comment">// matrix2的操作</span></span><br><span class="line">    _RDX = A;</span><br><span class="line">    result = i;</span><br><span class="line">    __asm</span><br><span class="line">    &#123;</span><br><span class="line">      vmovsd  xmm0, qword ptr [rdx+rax*<span class="number">8</span>]       <span class="comment">// ans</span></span><br><span class="line">      vmovsd  [rsp+<span class="number">188</span>h+var_1D0], xmm0</span><br><span class="line">      vbroadcastsd zmm0, [rsp+<span class="number">188</span>h+var_1D0]</span><br><span class="line">      vmovapd zmmword ptr [rsp+<span class="number">188</span>h+var_80], zmm0</span><br><span class="line">      vmovapd zmm0, zmmword ptr [rsp+<span class="number">188</span>h+var_140]</span><br><span class="line">      vmovapd zmmword ptr [rsp+<span class="number">188</span>h+var_40], zmm0</span><br><span class="line">      vmovapd zmm0, zmmword ptr [rsp+<span class="number">188</span>h+var_80]</span><br><span class="line">      vmulpd  zmm0, zmm0, zmmword ptr [rsp+<span class="number">188</span>h+var_40]</span><br><span class="line">      vmovapd zmmword ptr [rsp+<span class="number">188</span>h+var_C0], zmm0</span><br><span class="line">      vmovapd zmm0, zmmword ptr [rsp+<span class="number">188</span>h+var_1C0]</span><br><span class="line">      vmovapd zmmword ptr [rsp+<span class="number">188</span>h+var_100], zmm0</span><br><span class="line">      vmovapd zmm0, zmmword ptr [rsp+<span class="number">188</span>h+var_C0]</span><br><span class="line">      vmovapd zmmword ptr [rsp+<span class="number">188</span>h+var_180], zmm0</span><br><span class="line">      vmovapd zmm0, zmmword ptr [rsp+<span class="number">188</span>h+var_180]</span><br><span class="line">      vaddpd  zmm0, zmm0, zmmword ptr [rsp+<span class="number">188</span>h+var_100]</span><br><span class="line">      vmovapd zmmword ptr [rsp+<span class="number">188</span>h+var_1C0], zmm0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  __asm &#123; vmovapd zmm0, zmmword ptr [rsp+<span class="number">188</span>h+var_1C0] &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>But,really?</p>
<p>Let’s be out of the matmult function and observe the main function,you can see that a paramter called <code>A</code> in<code>.data</code> is passed to the matmult function .It occupies <code>2048</code> bytes.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matmult_SSE4((__int64)v29, (__int64)A, (__int64)v28, _XMM0);</span><br></pre></td></tr></table></figure>
<p>By reading the assembly  code you can know that the result is stored in <code>v29</code>(or you can guess it.<code>A</code> is the matrix to be mul, and <code>v28</code> store the flag strings processed by <code>rc</code>.So the result can only stored in <code>v29</code> )</p>
<p>And Let ‘s  analysis the <code>lincomb_SSE</code> function and see which data is used</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000017F7 mov     rdx, [rsp+188h+var_1F0]</span><br><span class="line">.text:00000000000017FC mov     eax, [rsp+188h+var_1DC]</span><br><span class="line">.text:0000000000001800 cdqe</span><br><span class="line">.text:0000000000001802 shl     rax, 7</span><br><span class="line">.text:0000000000001806 add     rax, rdx</span><br><span class="line">.text:0000000000001809 vmovsd  xmm0, qword ptr [rax] &#x2F;&#x2F;!</span><br><span class="line">.text:000000000000180D vmovsd  [rsp+188h+var_1C8], xmm0</span><br><span class="line">.text:0000000000001813 vbroadcastsd zmm0, [rsp+188h+var_1C8]</span><br><span class="line">.text:000000000000181B vmovapd zmmword ptr [rsp+188h+var_140], zmm0</span><br><span class="line">.text:0000000000001826 mov     rdx, [rsp+188h+var_1E8]</span><br><span class="line">.text:000000000000182B mov     eax, [rsp+188h+var_1DC]</span><br><span class="line">.text:000000000000182F cdqe</span><br><span class="line">.text:0000000000001831 vmovsd  xmm0, qword ptr [rdx+rax*8]</span><br><span class="line">.text:0000000000001836 vmovsd  [rsp+188h+var_1D0], xmm0</span><br><span class="line">.text:000000000000183C vbroadcastsd zmm0, [rsp+188h+var_1D0]</span><br><span class="line">.text:0000000000001844 vmovapd zmmword ptr [rsp+188h+var_80], zmm0</span><br><span class="line">.text:000000000000184F vmovapd zmm0, zmmword ptr [rsp+188h+var_140]</span><br><span class="line">.text:000000000000185A vmovapd zmmword ptr [rsp+188h+var_40], zmm0</span><br><span class="line">.text:0000000000001865 vmovapd zmm0, zmmword ptr [rsp+188h+var_80]</span><br><span class="line">.text:0000000000001870 vmulpd  zmm0, zmm0, zmmword ptr [rsp+188h+var_40]</span><br><span class="line">.text:000000000000187B vmovapd zmmword ptr [rsp+188h+var_C0], zmm0</span><br><span class="line">.text:0000000000001886 vmovapd zmm0, zmmword ptr [rsp+188h+var_1C0]</span><br><span class="line">.text:0000000000001891 vmovapd zmmword ptr [rsp+188h+var_100], zmm0</span><br><span class="line">.text:000000000000189C vmovapd zmm0, zmmword ptr [rsp+188h+var_C0]</span><br><span class="line">.text:00000000000018A7 vmovapd zmmword ptr [rsp+188h+var_180], zmm0</span><br><span class="line">.text:00000000000018B2 vmovapd zmm0, zmmword ptr [rsp+188h+var_180]</span><br><span class="line">.text:00000000000018BD vaddpd  zmm0, zmm0, zmmword ptr [rsp+188h+var_100]</span><br><span class="line">.text:00000000000018C8 vmovapd zmmword ptr [rsp+188h+var_1C0], zmm0</span><br><span class="line">.text:00000000000018D3 inc     [rsp+188h+var_1DC]</span><br></pre></td></tr></table></figure>
<p>Obviously, the element of the vector is obtain at  <code>0000000000001809</code> and stored in <code>[rsp+188h+var_140]</code>  ,the element of matrix is obtain at <code>0000000000001831</code> .the code at <code>0000000000001870</code> mul them(there is some code store and obtain,just trace the regs and memory and you can get what the operator is)</p>
<p>And ,the code at <code>00000000000018BD</code> to accumulate the sum.</p>
<p>So,We can set break point at  <code>0x0000000000001809</code> ,<code>0000000000001831</code> and  <code>00000000000018BD</code> to obverse.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p &amp;main-0x1100</span><br><span class="line"><span class="variable">$97</span> = (&lt;text variable, no debug info&gt; *) 0x564bb9367000</span><br><span class="line">(gdb) <span class="built_in">set</span> <span class="variable">$base</span>=0x564bb9367000</span><br><span class="line">(gdb) b *(<span class="variable">$base</span>+0x0000000000001809)</span><br><span class="line">Breakpoint 20 at 0x564bb9368809</span><br><span class="line">(gdb) b *(<span class="variable">$base</span>+0x0000000000001831)</span><br><span class="line">Breakpoint 21 at 0x564bb9368831</span><br><span class="line">(gdb) b *(<span class="variable">$base</span>+0x00000000000018bd)</span><br><span class="line">Breakpoint 22 at 0x564bb93688bd</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>and send flag  “1234” ,which is pad to “1234”+”X”*(16-4).After rc, it is traslate to something below</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc</span>(<span class="params">x</span>):</span></span><br><span class="line">	<span class="keyword">return</span> ((x&amp;<span class="number">0xf0</span>)|((((x&amp;<span class="number">0xf</span>)&gt;&gt;<span class="number">1</span>)|((x&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">3</span>))&amp;<span class="number">15</span>))</span><br><span class="line">m = [<span class="number">49</span>,<span class="number">50</span>,<span class="number">51</span>,<span class="number">52</span>]+[<span class="number">88</span>]*<span class="number">12</span></span><br><span class="line">tc = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">    tc.append(rc(i<span class="number">-33</span>))</span><br><span class="line">print(tc)</span><br><span class="line"><span class="comment">#[16, 24, 17, 25, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59]</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/08/29/yYdKx8TCa64Dbor.png" alt="image-20230829234137537"></p>
<p>Yes, the first element in vector is 16,and we go on.</p>
<p><img src="https://s2.loli.net/2023/08/29/G8rNAXUd5RxMj1h.png" alt="image-20230829234308013"></p>
<p>The second element is 55.which is just the first element in A (in double)</p>
<p><img src="https://s2.loli.net/2023/08/29/26Tu1XtrLpc4jfy.png" alt="image-20230829234422865"></p>
<p>so this round ,the num to be add is 55*16 = 880 </p>
<p><img src="https://s2.loli.net/2023/08/29/KzwnlyV8LZ6tgHJ.png" alt="image-20230829234547650"></p>
<p>so we can know that after 16 rounds ,the answer is the line comb of <code>[16, 24, 17, 25, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59]</code> and <code>[55,81,66,68,86,67,51,34,88,43,44,70,65,51,93,54]</code>,which is 49660</p>
<p>So we can set break point at 0x193e to see if our guess is true</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001939 call    _Z11lincomb_SSERKDv8_dRK5Mat16</span><br><span class="line">.text:000000000000193E vmovapd zmmword ptr [rsp+80h+var_40], zmm0</span><br></pre></td></tr></table></figure>
<p>it’s true.</p>
<p><img src="https://s2.loli.net/2023/08/29/g7diEhCQq8Wz5lJ.png" alt="image-20230829235122809"></p>
<p>but wait,we know that A occupies 2048 bytes,and each element in it occupies 8 bytes.So it has 256 elements.So it is a matrix of 16*16.Why in matmult_SSE4 it gets 32 rounds.</p>
<p>We can ignore it temporarily.We can abstract the element in A first and to see if every round of line comb is true</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">k = [<span class="string">&#x27;55&#x27;</span>, <span class="string">&#x27;81&#x27;</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;68&#x27;</span>, <span class="string">&#x27;86&#x27;</span>, <span class="string">&#x27;67&#x27;</span>, <span class="string">&#x27;51&#x27;</span>, <span class="string">&#x27;34&#x27;</span>, <span class="string">&#x27;88&#x27;</span>, <span class="string">&#x27;43&#x27;</span>, <span class="string">&#x27;44&#x27;</span>, <span class="string">&#x27;70&#x27;</span>, <span class="string">&#x27;65&#x27;</span>, <span class="string">&#x27;51&#x27;</span>, <span class="string">&#x27;93&#x27;</span>, <span class="string">&#x27;54&#x27;</span>, <span class="string">&#x27;73&#x27;</span>, <span class="string">&#x27;45&#x27;</span>, <span class="string">&#x27;54&#x27;</span>, <span class="string">&#x27;35&#x27;</span>, <span class="string">&#x27;82&#x27;</span>, <span class="string">&#x27;59&#x27;</span>, <span class="string">&#x27;67&#x27;</span>, <span class="string">&#x27;84&#x27;</span>, <span class="string">&#x27;87&#x27;</span>, <span class="string">&#x27;46&#x27;</span>, <span class="string">&#x27;69&#x27;</span>, <span class="string">&#x27;46&#x27;</span>, <span class="string">&#x27;46&#x27;</span>, <span class="string">&#x27;80&#x27;</span>, <span class="string">&#x27;79&#x27;</span>, <span class="string">&#x27;51&#x27;</span>, <span class="string">&#x27;39&#x27;</span>, <span class="string">&#x27;50&#x27;</span>, <span class="string">&#x27;57&#x27;</span>, <span class="string">&#x27;67&#x27;</span>, <span class="string">&#x27;51&#x27;</span>, <span class="string">&#x27;68&#x27;</span>, <span class="string">&#x27;61&#x27;</span>, <span class="string">&#x27;32&#x27;</span>, <span class="string">&#x27;79&#x27;</span>, <span class="string">&#x27;48&#x27;</span>, <span class="string">&#x27;35&#x27;</span>, <span class="string">&#x27;90&#x27;</span>, <span class="string">&#x27;63&#x27;</span>, <span class="string">&#x27;69&#x27;</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;52&#x27;</span>, <span class="string">&#x27;70&#x27;</span>, <span class="string">&#x27;55&#x27;</span>, <span class="string">&#x27;64&#x27;</span>, <span class="string">&#x27;40&#x27;</span>, <span class="string">&#x27;52&#x27;</span>, <span class="string">&#x27;84&#x27;</span>, <span class="string">&#x27;79&#x27;</span>, <span class="string">&#x27;77&#x27;</span>, <span class="string">&#x27;51&#x27;</span>, <span class="string">&#x27;60&#x27;</span>, <span class="string">&#x27;74&#x27;</span>, <span class="string">&#x27;57&#x27;</span>, <span class="string">&#x27;95&#x27;</span>, <span class="string">&#x27;78&#x27;</span>, <span class="string">&#x27;93&#x27;</span>, <span class="string">&#x27;41&#x27;</span>, <span class="string">&#x27;70&#x27;</span>, <span class="string">&#x27;77&#x27;</span>, <span class="string">&#x27;58&#x27;</span>, <span class="string">&#x27;78&#x27;</span>, <span class="string">&#x27;68&#x27;</span>, <span class="string">&#x27;83&#x27;</span>, <span class="string">&#x27;49&#x27;</span>, <span class="string">&#x27;37&#x27;</span>, <span class="string">&#x27;90&#x27;</span>, <span class="string">&#x27;53&#x27;</span>, <span class="string">&#x27;61&#x27;</span>, <span class="string">&#x27;91&#x27;</span>, <span class="string">&#x27;65&#x27;</span>, <span class="string">&#x27;65&#x27;</span>, <span class="string">&#x27;95&#x27;</span>, <span class="string">&#x27;58&#x27;</span>, <span class="string">&#x27;71&#x27;</span>, <span class="string">&#x27;64&#x27;</span>, <span class="string">&#x27;91&#x27;</span>, <span class="string">&#x27;90&#x27;</span>, <span class="string">&#x27;87&#x27;</span>, <span class="string">&#x27;57&#x27;</span>, <span class="string">&#x27;53&#x27;</span>, <span class="string">&#x27;75&#x27;</span>, <span class="string">&#x27;48&#x27;</span>, <span class="string">&#x27;68&#x27;</span>, <span class="string">&#x27;48&#x27;</span>, <span class="string">&#x27;69&#x27;</span>, <span class="string">&#x27;73&#x27;</span>, <span class="string">&#x27;63&#x27;</span>, <span class="string">&#x27;47&#x27;</span>, <span class="string">&#x27;51&#x27;</span>, <span class="string">&#x27;63&#x27;</span>, <span class="string">&#x27;49&#x27;</span>, <span class="string">&#x27;74&#x27;</span>, <span class="string">&#x27;50&#x27;</span>, <span class="string">&#x27;52&#x27;</span>, <span class="string">&#x27;95&#x27;</span>, <span class="string">&#x27;32&#x27;</span>, <span class="string">&#x27;83&#x27;</span>, <span class="string">&#x27;65&#x27;</span>, <span class="string">&#x27;85&#x27;</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;53&#x27;</span>, <span class="string">&#x27;85&#x27;</span>, <span class="string">&#x27;74&#x27;</span>, <span class="string">&#x27;42&#x27;</span>, <span class="string">&#x27;81&#x27;</span>, <span class="string">&#x27;33&#x27;</span>, <span class="string">&#x27;46&#x27;</span>, <span class="string">&#x27;63&#x27;</span>, <span class="string">&#x27;85&#x27;</span>, <span class="string">&#x27;39&#x27;</span>, <span class="string">&#x27;80&#x27;</span>, <span class="string">&#x27;89&#x27;</span>, <span class="string">&#x27;50&#x27;</span>, <span class="string">&#x27;62&#x27;</span>, <span class="string">&#x27;70&#x27;</span>, <span class="string">&#x27;47&#x27;</span>, <span class="string">&#x27;70&#x27;</span>, <span class="string">&#x27;39&#x27;</span>, <span class="string">&#x27;56&#x27;</span>, <span class="string">&#x27;54&#x27;</span>, <span class="string">&#x27;61&#x27;</span>, <span class="string">&#x27;67&#x27;</span>, <span class="string">&#x27;36&#x27;</span>, <span class="string">&#x27;84&#x27;</span>, <span class="string">&#x27;70&#x27;</span>, <span class="string">&#x27;91&#x27;</span>, <span class="string">&#x27;58&#x27;</span>, <span class="string">&#x27;68&#x27;</span>, <span class="string">&#x27;87&#x27;</span>, <span class="string">&#x27;33&#x27;</span>, <span class="string">&#x27;77&#x27;</span>, <span class="string">&#x27;91&#x27;</span>, <span class="string">&#x27;88&#x27;</span>, <span class="string">&#x27;87&#x27;</span>, <span class="string">&#x27;46&#x27;</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;67&#x27;</span>, <span class="string">&#x27;60&#x27;</span>, <span class="string">&#x27;80&#x27;</span>, <span class="string">&#x27;35&#x27;</span>, <span class="string">&#x27;79&#x27;</span>, <span class="string">&#x27;69&#x27;</span>, <span class="string">&#x27;45&#x27;</span>, <span class="string">&#x27;54&#x27;</span>, <span class="string">&#x27;79&#x27;</span>, <span class="string">&#x27;76&#x27;</span>, <span class="string">&#x27;49&#x27;</span>, <span class="string">&#x27;38&#x27;</span>, <span class="string">&#x27;75&#x27;</span>, <span class="string">&#x27;35&#x27;</span>, <span class="string">&#x27;77&#x27;</span>, <span class="string">&#x27;70&#x27;</span>, <span class="string">&#x27;91&#x27;</span>, <span class="string">&#x27;91&#x27;</span>, <span class="string">&#x27;74&#x27;</span>, <span class="string">&#x27;63&#x27;</span>, <span class="string">&#x27;55&#x27;</span>, <span class="string">&#x27;63&#x27;</span>, <span class="string">&#x27;76&#x27;</span>, <span class="string">&#x27;83&#x27;</span>, <span class="string">&#x27;39&#x27;</span>, <span class="string">&#x27;61&#x27;</span>, <span class="string">&#x27;69&#x27;</span>, <span class="string">&#x27;61&#x27;</span>, <span class="string">&#x27;49&#x27;</span>, <span class="string">&#x27;92&#x27;</span>, <span class="string">&#x27;34&#x27;</span>, <span class="string">&#x27;75&#x27;</span>, <span class="string">&#x27;52&#x27;</span>, <span class="string">&#x27;87&#x27;</span>, <span class="string">&#x27;80&#x27;</span>, <span class="string">&#x27;83&#x27;</span>, <span class="string">&#x27;43&#x27;</span>, <span class="string">&#x27;36&#x27;</span>, <span class="string">&#x27;49&#x27;</span>, <span class="string">&#x27;62&#x27;</span>, <span class="string">&#x27;86&#x27;</span>, <span class="string">&#x27;51&#x27;</span>, <span class="string">&#x27;49&#x27;</span>, <span class="string">&#x27;67&#x27;</span>, <span class="string">&#x27;65&#x27;</span>, <span class="string">&#x27;69&#x27;</span>, <span class="string">&#x27;92&#x27;</span>, <span class="string">&#x27;95&#x27;</span>, <span class="string">&#x27;42&#x27;</span>, <span class="string">&#x27;44&#x27;</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;68&#x27;</span>, <span class="string">&#x27;88&#x27;</span>, <span class="string">&#x27;79&#x27;</span>, <span class="string">&#x27;45&#x27;</span>, <span class="string">&#x27;46&#x27;</span>, <span class="string">&#x27;70&#x27;</span>, <span class="string">&#x27;74&#x27;</span>, <span class="string">&#x27;94&#x27;</span>, <span class="string">&#x27;75&#x27;</span>, <span class="string">&#x27;50&#x27;</span>, <span class="string">&#x27;75&#x27;</span>, <span class="string">&#x27;77&#x27;</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;48&#x27;</span>, <span class="string">&#x27;39&#x27;</span>, <span class="string">&#x27;58&#x27;</span>, <span class="string">&#x27;73&#x27;</span>, <span class="string">&#x27;65&#x27;</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;63&#x27;</span>, <span class="string">&#x27;77&#x27;</span>, <span class="string">&#x27;56&#x27;</span>, <span class="string">&#x27;80&#x27;</span>, <span class="string">&#x27;85&#x27;</span>, <span class="string">&#x27;57&#x27;</span>, <span class="string">&#x27;79&#x27;</span>, <span class="string">&#x27;58&#x27;</span>, <span class="string">&#x27;78&#x27;</span>, <span class="string">&#x27;64&#x27;</span>, <span class="string">&#x27;37&#x27;</span>, <span class="string">&#x27;78&#x27;</span>, <span class="string">&#x27;75&#x27;</span>, <span class="string">&#x27;90&#x27;</span>, <span class="string">&#x27;78&#x27;</span>, <span class="string">&#x27;49&#x27;</span>, <span class="string">&#x27;76&#x27;</span>, <span class="string">&#x27;79&#x27;</span>, <span class="string">&#x27;68&#x27;</span>, <span class="string">&#x27;82&#x27;</span>, <span class="string">&#x27;76&#x27;</span>, <span class="string">&#x27;87&#x27;</span>, <span class="string">&#x27;82&#x27;</span>, <span class="string">&#x27;73&#x27;</span>, <span class="string">&#x27;52&#x27;</span>, <span class="string">&#x27;46&#x27;</span>, <span class="string">&#x27;93&#x27;</span>, <span class="string">&#x27;36&#x27;</span>, <span class="string">&#x27;34&#x27;</span>, <span class="string">&#x27;41&#x27;</span>, <span class="string">&#x27;94&#x27;</span>, <span class="string">&#x27;55&#x27;</span>, <span class="string">&#x27;42&#x27;</span>, <span class="string">&#x27;58&#x27;</span>, <span class="string">&#x27;54&#x27;</span>, <span class="string">&#x27;37&#x27;</span>, <span class="string">&#x27;40&#x27;</span>, <span class="string">&#x27;76&#x27;</span>, <span class="string">&#x27;90&#x27;</span>, <span class="string">&#x27;95&#x27;</span>, <span class="string">&#x27;40&#x27;</span>, <span class="string">&#x27;75&#x27;</span>]</span><br><span class="line">A = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    tmp = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        tmp.append(int(k[i*<span class="number">16</span>+j]))</span><br><span class="line">    A.append(tmp)</span><br><span class="line">m = [<span class="number">49</span>,<span class="number">50</span>,<span class="number">51</span>,<span class="number">52</span>]+[<span class="number">88</span>]*<span class="number">12</span></span><br><span class="line">tc = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">    tc.append(rc(i<span class="number">-33</span>))</span><br><span class="line">ans = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        cnt+=A[i][j]*tc[j]</span><br><span class="line">    ans.append(cnt)</span><br><span class="line">print(ans)</span><br><span class="line"><span class="comment">#[49660, 51005, 46594, 54147, 53989, 50070, 52659, 47131, 55795, 50172, 50164, 50815, 53847, 53367, 56021, 48559]</span></span><br></pre></td></tr></table></figure>
<p>the round 0 is true(49660) ,but the round 1 is 49860, and the round 2 is 51005(true)</p>
<p><img src="https://s2.loli.net/2023/08/30/8FlHQ3PrhDmb41a.png" alt="image-20230830000708814"></p>
<p>It seems we get true ans in even round.Why?</p>
<p>It is because we translate A by 1&lt;&lt;6 =64 bytes offset (which is 8 elements),not 16 elements</p>
<p><img src="https://s2.loli.net/2023/08/30/o8uwOmPUCHqVhpG.png" alt="image-20230830001233694"></p>
<p><img src="https://s2.loli.net/2023/08/30/Oelsd3Tf6nGhKCI.png" alt="image-20230830001212087"></p>
<p>it doesn’t matter because you can know we store  0x80 bytes one time (which is) and we only use the first part.</p>
<p><img src="https://s2.loli.net/2023/08/30/pORiP7XkG3KgIfM.png" alt="image-20230830001452083"></p>
<h4 id="mul-sub-add"><a href="#mul-sub-add" class="headerlink" title="mul,sub,add"></a>mul,sub,add</h4><p>for the mul function,you can just read the code and will find that there are a lot of junk code.All it does is just mul two numbers and send the answer to<code>xmm0</code>. Or you can debug it without read the asm code</p>
<p><img src="https://s2.loli.net/2023/08/30/tyazfYsORGS1ZCl.png" alt="image-20230830001956776"></p>
<p>the <code>xmm1</code> is setted by <code>vmovss  xmm1, cs:dword_20A0</code>,So we can know the <code>dword_20A0</code> is a float -&gt; 0.0106382975 (which is nealy 1/94)</p>
<p><img src="https://s2.loli.net/2023/08/30/jONH8VBaiLuzYEn.png" alt="image-20230830002200083"></p>
<p>just 49660*0.0106382975=528.297852</p>
<p>and by code <code>vcvttss2usi eax, xmm0</code>, the float is round down to 528 and send to <code>xmm1</code></p>
<p><img src="https://s2.loli.net/2023/08/30/RBU4aPS7XELAQiY.png" alt="image-20230830002339306"></p>
<p>similarly,We set bp on the second mul and get <code>dword_20A4</code> is 94</p>
<p><img src="https://s2.loli.net/2023/08/30/CYGDX5oZW39VNuS.png" alt="image-20230830002507418"></p>
<p>As for the <code>sub</code> and <code>add</code></p>
<p>It’s just sub and add. If you analysis the AVX code one by one ,you will find the only useful code is the recursion.So it’s just a sub function using recursion.<code>add</code> is the same .</p>
<p><img src="https://s2.loli.net/2023/08/30/QFI5Xj8rsLTSYPV.png" alt="image-20230830002734307"></p>
<p>or you can set bp to see how it get  and how it result</p>
<p><img src="https://s2.loli.net/2023/08/30/NhKsG1xbUoizQTY.png" alt="image-20230830002936915"></p>
<p><img src="https://s2.loli.net/2023/08/30/gvTiKSBrUEFnRku.png" alt="image-20230830002952450"></p>
<p>(49660-49632 = 28)</p>
<p>so the ciphertext is 28+33=61</p>
<p><img src="https://s2.loli.net/2023/08/30/cDVSyRQ9YTfbeXw.png" alt="image-20230830003111611"></p>
<p>you can just write the enc code </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">m</span>):</span></span><br><span class="line">    tc = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">        tc.append(rc(i<span class="number">-33</span>))</span><br><span class="line">    c = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">            cnt+= A[i][j]*tc[j]</span><br><span class="line">        c.append(cnt)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        to_add = c[i]-int(c[i]*<span class="number">0.0106382975</span>)*<span class="number">94</span>+<span class="number">33</span></span><br><span class="line">        ans.append(to_add)</span><br><span class="line">    <span class="keyword">return</span> c</span><br></pre></td></tr></table></figure>
<p>you can set bp on the compare code to see if the encrypt code we analysis is true.</p>
<h3 id="solve-the-problem"><a href="#solve-the-problem" class="headerlink" title="solve the problem"></a>solve the problem</h3><p>haha,It’s a long story for me to say how i solve it.I used to be a CTFer majored in crypto.And the matrix,floating-point errors reminds me of the LWE problem.</p>
<p>The problem in this challenge can be descrypt as</p>
<script type="math/tex; mode=display">
A\vec{x} - [A\vec{x}*a ]*94 = \vec{b}</script><p>and a is colsed to 1/94.</p>
<p>I used to solve a problem ,it can descript as</p>
<script type="math/tex; mode=display">
A\vec{x} = \vec{b}</script><p>and $A$ is a float matrix and you can’t find the inverse matrix of $A$ causing by floating point errors,The right method is to construt Lattice and using LLL</p>
<script type="math/tex; mode=display">
\left(
\begin{array}{c}
    \vec{x},-1

\end{array}
\right)
\begin{pmatrix}
    A& E\\
    \vec{b}&\vec{0}
\end{pmatrix}
 \approx \left(
\begin{array}{c}
    \vec{e},\vec{x},0

\end{array}
\right)</script><p>So,I think I can rewrite the challenge to            </p>
<script type="math/tex; mode=display">
A\vec{x} - (A\vec{x}*a -\vec{err})*94 = \vec{b}</script><p>and construct lattice to solve it.But I soon realize that the $\vec{err}$ is not small enough,may not meed the Minkowski bound .So I try my best to optimize the lattice ,but didn’t work.</p>
<p>you could see how stupid i was</p>
<p><img src="https://s2.loli.net/2023/08/30/gkp3nS8jNyOteqa.png" alt="image-20230830005305276"></p>
<p>After the competition, the second day,I realize that $a-[a/b]*b$ is just$ a \mod b$ </p>
<p>WHAT THE F**K??? I forget it and overthink it, it’s just a problem to solve $A\vec{x} = \vec{b}$ on $Zmod(94)$</p>
<p>all the parameter is inter.No float ,No Error</p>
<p>F**K!</p>
<p>So the exp can be write rapidly in SageMath</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">c = [  <span class="number">0x2F</span>, <span class="number">0x4D</span>, <span class="number">0x3D</span>, <span class="number">0x6C</span>, <span class="number">0x64</span>, <span class="number">0x44</span>, <span class="number">0x4C</span>, <span class="number">0x63</span>, <span class="number">0x50</span>, <span class="number">0x6B</span>, </span><br><span class="line">  <span class="number">0x57</span>, <span class="number">0x52</span>, <span class="number">0x2A</span>, <span class="number">0x38</span>, <span class="number">0x73</span>, <span class="number">0x3C</span>, <span class="number">0x46</span>, <span class="number">0x23</span>, <span class="number">0x2F</span>, <span class="number">0x3D</span>, </span><br><span class="line">  <span class="number">0x5C</span>, <span class="number">0x54</span>, <span class="number">0x49</span>, <span class="number">0x4A</span>, <span class="number">0x3D</span>, <span class="number">0x2A</span>, <span class="number">0x62</span>, <span class="number">0x5C</span>, <span class="number">0x29</span>, <span class="number">0x75</span>, </span><br><span class="line">  <span class="number">0x59</span>, <span class="number">0x34</span>, <span class="number">0x2D</span>, <span class="number">0x47</span>, <span class="number">0x25</span>, <span class="number">0x4F</span>, <span class="number">0x22</span>, <span class="number">0x46</span>, <span class="number">0x45</span>, <span class="number">0x63</span>, </span><br><span class="line">  <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0x47</span>, <span class="number">0x69</span>, <span class="number">0x5B</span>, <span class="number">0x7D</span>, <span class="number">0x7B</span>, <span class="number">0x4A</span>, <span class="number">0x48</span>, <span class="number">0x3E</span>, </span><br><span class="line">  <span class="number">0x5B</span>, <span class="number">0x79</span>, <span class="number">0x43</span>, <span class="number">0x60</span>, <span class="number">0x42</span>, <span class="number">0x61</span>, <span class="number">0x66</span>, <span class="number">0x30</span>, <span class="number">0x70</span>, <span class="number">0x7D</span>, </span><br><span class="line">  <span class="number">0x28</span>, <span class="number">0x3D</span>, <span class="number">0x2D</span>, <span class="number">0x74</span>, <span class="number">0x00</span>]</span><br><span class="line">A = [[<span class="number">55</span>, <span class="number">81</span>, <span class="number">66</span>, <span class="number">68</span>, <span class="number">86</span>, <span class="number">67</span>, <span class="number">51</span>, <span class="number">34</span>, <span class="number">88</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">70</span>, <span class="number">65</span>, <span class="number">51</span>, <span class="number">93</span>, <span class="number">54</span>], [<span class="number">73</span>, <span class="number">45</span>, <span class="number">54</span>, <span class="number">35</span>, <span class="number">82</span>, <span class="number">59</span>, <span class="number">67</span>, <span class="number">84</span>, <span class="number">87</span>, <span class="number">46</span>, <span class="number">69</span>, <span class="number">46</span>, <span class="number">46</span>, <span class="number">80</span>, <span class="number">79</span>, <span class="number">51</span>], [<span class="number">39</span>, <span class="number">50</span>, <span class="number">57</span>, <span class="number">67</span>, <span class="number">51</span>, <span class="number">68</span>, <span class="number">61</span>, <span class="number">32</span>, <span class="number">79</span>, <span class="number">48</span>, <span class="number">35</span>, <span class="number">90</span>, <span class="number">63</span>, <span class="number">69</span>, <span class="number">66</span>, <span class="number">52</span>], [<span class="number">70</span>, <span class="number">55</span>, <span class="number">64</span>, <span class="number">40</span>, <span class="number">52</span>, <span class="number">84</span>, <span class="number">79</span>, <span class="number">77</span>, <span class="number">51</span>, <span class="number">60</span>, <span class="number">74</span>, <span class="number">57</span>, <span class="number">95</span>, <span class="number">78</span>, <span class="number">93</span>, <span class="number">41</span>], [<span class="number">70</span>, <span class="number">77</span>, <span class="number">58</span>, <span class="number">78</span>, <span class="number">68</span>, <span class="number">83</span>, <span class="number">49</span>, <span class="number">37</span>, <span class="number">90</span>, <span class="number">53</span>, <span class="number">61</span>, <span class="number">91</span>, <span class="number">65</span>, <span class="number">65</span>, <span class="number">95</span>, <span class="number">58</span>], [<span class="number">71</span>, <span class="number">64</span>, <span class="number">91</span>, <span class="number">90</span>, <span class="number">87</span>, <span class="number">57</span>, <span class="number">53</span>, <span class="number">75</span>, <span class="number">48</span>, <span class="number">68</span>, <span class="number">48</span>, <span class="number">69</span>, <span class="number">73</span>, <span class="number">63</span>, <span class="number">47</span>, <span class="number">51</span>], [<span class="number">63</span>, <span class="number">49</span>, <span class="number">74</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">95</span>, <span class="number">32</span>, <span class="number">83</span>, <span class="number">65</span>, <span class="number">85</span>, <span class="number">66</span>, <span class="number">53</span>, <span class="number">85</span>, <span class="number">74</span>, <span class="number">42</span>, <span class="number">81</span>], [<span class="number">33</span>, <span class="number">46</span>, <span class="number">63</span>, <span class="number">85</span>, <span class="number">39</span>, <span class="number">80</span>, <span class="number">89</span>, <span class="number">50</span>, <span class="number">62</span>, <span class="number">70</span>, <span class="number">47</span>, <span class="number">70</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">54</span>, <span class="number">61</span>], [<span class="number">67</span>, <span class="number">36</span>, <span class="number">84</span>, <span class="number">70</span>, <span class="number">91</span>, <span class="number">58</span>, <span class="number">68</span>, <span class="number">87</span>, <span class="number">33</span>, <span class="number">77</span>, <span class="number">91</span>, <span class="number">88</span>, <span class="number">87</span>, <span class="number">46</span>, <span class="number">66</span>, <span class="number">67</span>], [<span class="number">60</span>, <span class="number">80</span>, <span class="number">35</span>, <span class="number">79</span>, <span class="number">69</span>, <span class="number">45</span>, <span class="number">54</span>, <span class="number">79</span>, <span class="number">76</span>, <span class="number">49</span>, <span class="number">38</span>, <span class="number">75</span>, <span class="number">35</span>, <span class="number">77</span>, <span class="number">70</span>, <span class="number">91</span>], [<span class="number">91</span>, <span class="number">74</span>, <span class="number">63</span>, <span class="number">55</span>, <span class="number">63</span>, <span class="number">76</span>, <span class="number">83</span>, <span class="number">39</span>, <span class="number">61</span>, <span class="number">69</span>, <span class="number">61</span>, <span class="number">49</span>, <span class="number">92</span>, <span class="number">34</span>, <span class="number">75</span>, <span class="number">52</span>], [<span class="number">87</span>, <span class="number">80</span>, <span class="number">83</span>, <span class="number">43</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">62</span>, <span class="number">86</span>, <span class="number">51</span>, <span class="number">49</span>, <span class="number">67</span>, <span class="number">65</span>, <span class="number">69</span>, <span class="number">92</span>, <span class="number">95</span>, <span class="number">42</span>], [<span class="number">44</span>, <span class="number">66</span>, <span class="number">68</span>, <span class="number">88</span>, <span class="number">79</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">70</span>, <span class="number">74</span>, <span class="number">94</span>, <span class="number">75</span>, <span class="number">50</span>, <span class="number">75</span>, <span class="number">77</span>, <span class="number">66</span>, <span class="number">66</span>], [<span class="number">48</span>, <span class="number">39</span>, <span class="number">58</span>, <span class="number">73</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">63</span>, <span class="number">77</span>, <span class="number">56</span>, <span class="number">80</span>, <span class="number">85</span>, <span class="number">57</span>, <span class="number">79</span>, <span class="number">58</span>, <span class="number">78</span>, <span class="number">64</span>], [<span class="number">37</span>, <span class="number">78</span>, <span class="number">75</span>, <span class="number">90</span>, <span class="number">78</span>, <span class="number">49</span>, <span class="number">76</span>, <span class="number">79</span>, <span class="number">68</span>, <span class="number">82</span>, <span class="number">76</span>, <span class="number">87</span>, <span class="number">82</span>, <span class="number">73</span>, <span class="number">52</span>, <span class="number">46</span>], [<span class="number">93</span>, <span class="number">36</span>, <span class="number">34</span>, <span class="number">41</span>, <span class="number">94</span>, <span class="number">55</span>, <span class="number">42</span>, <span class="number">58</span>, <span class="number">54</span>, <span class="number">37</span>, <span class="number">40</span>, <span class="number">76</span>, <span class="number">90</span>, <span class="number">95</span>, <span class="number">40</span>, <span class="number">75</span>]]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rev_rc</span>(<span class="params">x</span>):</span></span><br><span class="line">	<span class="keyword">return</span> ((x&amp;<span class="number">0xf0</span>)|((((x&amp;<span class="number">0xf</span>)&gt;&gt;<span class="number">3</span>)|((x&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">1</span>))&amp;<span class="number">15</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(c)):</span><br><span class="line">    c[i]-=<span class="number">33</span></span><br><span class="line">M = Matrix(Zmod(<span class="number">94</span>),A)</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(c)<span class="number">-16</span>,<span class="number">16</span>):</span><br><span class="line">    b = vector(Zmod(<span class="number">94</span>),c[i:i+<span class="number">16</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> M.solve_right(b):</span><br><span class="line">        flag +=chr(rev_rc(int(i))+<span class="number">33</span>)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/08/30/vesfzUGKDiRMJuy.png" alt="image-20230830010156428"></p>
<h2 id="Guardians-of-the-Kernel"><a href="#Guardians-of-the-Kernel" class="headerlink" title="Guardians of the Kernel"></a>Guardians of the Kernel</h2><h3 id="description-1"><a href="#description-1" class="headerlink" title="description"></a>description</h3><p><img src="https://s2.loli.net/2023/08/30/Ya3Uw5uAkzsOtyP.png" alt="image-20230830202713264"></p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><p>Like what we do on kernel pwn,just unpack the <code>initramfs.cpio.gz</code> and <code>cpio -idmv &lt; ../xxx.cpio</code> and you will get a file system.</p>
<p>And there is two part of the flag.just burst it</p>
<p><img src="https://s2.loli.net/2023/08/30/Tz2wXi9BfRlkJpo.png" alt="image-20230830203008345"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _DWORD uint32_t</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">T</span> __<span class="title">ROL__</span>(<span class="title">T</span> <span class="title">value</span>, <span class="title">int</span> <span class="title">count</span>)</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">const</span> uint nbits = <span class="keyword">sizeof</span>(T) * <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( count &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    count %= nbits;</span><br><span class="line">    T high = value &gt;&gt; (nbits - count);</span><br><span class="line">    <span class="keyword">if</span> ( T(<span class="number">-1</span>) &lt; <span class="number">0</span> ) <span class="comment">// signed value</span></span><br><span class="line">      high &amp;= ~((T(<span class="number">-1</span>) &lt;&lt; count));</span><br><span class="line">    value &lt;&lt;= count;</span><br><span class="line">    value |= high;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    count = -count % nbits;</span><br><span class="line">    T low = value &lt;&lt; (nbits - count);</span><br><span class="line">    value &gt;&gt;= count;</span><br><span class="line">    value |= low;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">uint32_t</span> __ROL4__(<span class="keyword">uint32_t</span> value, <span class="keyword">int</span> count) &#123; <span class="keyword">return</span> __ROL__((<span class="keyword">uint32_t</span>)value, count); &#125;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">uint32_t</span> __ROR4__(<span class="keyword">uint32_t</span> value, <span class="keyword">int</span> count) &#123; <span class="keyword">return</span> __ROL__((<span class="keyword">uint32_t</span>)value, -count); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">enc</span><span class="params">(<span class="keyword">char</span>* buffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> *v6; <span class="comment">// rax</span></span><br><span class="line">    <span class="keyword">int</span> v7; <span class="comment">// edx</span></span><br><span class="line">    <span class="keyword">int</span> v8; <span class="comment">// eax</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">      v6 = (<span class="keyword">uint8_t</span>*)buffer;</span><br><span class="line">      <span class="keyword">while</span> ( (<span class="keyword">uint8_t</span>)(*v6 - <span class="string">&#x27;0&#x27;</span>) &lt;= <span class="number">9u</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">uint8_t</span>*)&amp;buffer[<span class="number">7</span>] == ++v6 )</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = <span class="number">7</span> * __ROL4__(<span class="number">1507359807</span> * __ROR4__(<span class="number">422871738</span> * *(_DWORD *)buffer, <span class="number">15</span>), <span class="number">11</span>);</span><br><span class="line">          v8 = __ROR4__(<span class="number">422871738</span> * ((buffer[<span class="number">5</span>] &lt;&lt; <span class="number">8</span>) ^ (buffer[<span class="number">6</span>] &lt;&lt; <span class="number">16</span>) ^ buffer[<span class="number">4</span>]), <span class="number">15</span>);</span><br><span class="line">          v9 = <span class="number">0x764521F9</span></span><br><span class="line">             * ((v7 + <span class="number">1204333666</span>) ^ (<span class="number">1507359807</span> * v8) ^ <span class="number">7</span> ^ (((v7 + <span class="number">1204333666</span>) ^ (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="number">1507359807</span> * v8)) &gt;&gt; <span class="number">16</span>));</span><br><span class="line">          <span class="keyword">if</span> ( (((<span class="number">-1817436554</span> * ((v9 &gt;&gt; <span class="number">13</span>) ^ v9)) &gt;&gt; <span class="number">16</span>) ^ (<span class="number">-1817436554</span> * ((v9 &gt;&gt; <span class="number">13</span>) ^ v9))) != <span class="number">261736481</span> )</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// int fd = open(&quot;/proc/Flag-Checker&quot;,2);</span></span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">7</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// printf(&quot;%d&quot;,ioctl(fd,0x7000,&quot;SEKAI&#123;&quot;));</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">long</span> <span class="keyword">long</span> i=<span class="number">0</span>;i&lt;<span class="number">10000000</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="number">7</span>);</span><br><span class="line">        <span class="built_in">sprintf</span>(buf,<span class="string">&quot;%lld&quot;</span>,i);</span><br><span class="line">        <span class="keyword">if</span>(enc(buf)==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,buf);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printf(&quot;%s\n&quot;,buf);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>this part is also easy,just reverse,which is <code>c[i] -=c[i+1]*~i</code></p>
<p><img src="https://s2.loli.net/2023/08/30/rYNAQdbgIkFU4xs.png" alt="image-20230830203137066"></p>
<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Photon</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://phot0n.com/2023/08/29/WriteUps-for-some-problems-in-SekaiCTF-2023/">http://phot0n.com/2023/08/29/WriteUps-for-some-problems-in-SekaiCTF-2023/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pwn/">pwn</a><a class="post-meta__tags" href="/tags/reverse/">reverse</a><a class="post-meta__tags" href="/tags/writeup/">writeup</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/06/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/"><img class="prev-cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">近期比赛复现</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/19/CVE-2016-9793%E5%88%86%E6%9E%90/"><img class="next-cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">CVE-2016-9793分析</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/09/11/HITCONCTF-2023/" title="HITCONCTF-2023"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-11</div><div class="title">HITCONCTF-2023</div></div></a></div><div><a href="/2023/09/06/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/" title="近期比赛复现"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-06</div><div class="title">近期比赛复现</div></div></a></div><div><a href="/2023/04/19/CVE-2016-9793%E5%88%86%E6%9E%90/" title="CVE-2016-9793分析"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-19</div><div class="title">CVE-2016-9793分析</div></div></a></div><div><a href="/2023/04/08/QEMU-RUN/" title="QEMU逃逸入门"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-08</div><div class="title">QEMU逃逸入门</div></div></a></div><div><a href="/2023/03/31/libc%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E4%B8%8E%E5%88%86%E6%9E%90/" title="libc的源码调试与分析"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-31</div><div class="title">libc的源码调试与分析</div></div></a></div><div><a href="/2023/01/19/%E5%86%85%E6%A0%B8%E5%A0%86%E5%88%A9%E7%94%A8%E7%9B%B8%E5%85%B3/" title="内核堆利用相关"><img class="cover" src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-19</div><div class="title">内核堆利用相关</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2022/01/19/K4TwFgDxsJ62tEo.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Photon</div><div class="author-info__description">光子</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">55</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">32</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/photonwork"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/photonwork" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">1.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Sahuang-Flag-Checker"><span class="toc-number">1.1.</span> <span class="toc-text">Sahuang Flag Checker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#description"><span class="toc-number">1.1.1.</span> <span class="toc-text">description</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Emulate"><span class="toc-number">1.1.2.</span> <span class="toc-text">Emulate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Analysis"><span class="toc-number">1.1.3.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rc"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">rc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#matmult-SSE4"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">matmult_SSE4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mul-sub-add"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">mul,sub,add</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solve-the-problem"><span class="toc-number">1.1.4.</span> <span class="toc-text">solve the problem</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Guardians-of-the-Kernel"><span class="toc-number">1.2.</span> <span class="toc-text">Guardians of the Kernel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#description-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">description</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution"><span class="toc-number">1.2.2.</span> <span class="toc-text">solution</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pwn"><span class="toc-number">2.</span> <span class="toc-text">Pwn</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/09/11/HITCONCTF-2023/" title="HITCONCTF-2023"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HITCONCTF-2023"/></a><div class="content"><a class="title" href="/2023/09/11/HITCONCTF-2023/" title="HITCONCTF-2023">HITCONCTF-2023</a><time datetime="2023-09-11T04:39:49.000Z" title="Created 2023-09-11 12:39:49">2023-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/06/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/" title="近期比赛复现"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="近期比赛复现"/></a><div class="content"><a class="title" href="/2023/09/06/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/" title="近期比赛复现">近期比赛复现</a><time datetime="2023-09-06T12:01:22.000Z" title="Created 2023-09-06 20:01:22">2023-09-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/29/WriteUps-for-some-problems-in-SekaiCTF-2023/" title="WriteUps for some problems in SekaiCTF-2023"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WriteUps for some problems in SekaiCTF-2023"/></a><div class="content"><a class="title" href="/2023/08/29/WriteUps-for-some-problems-in-SekaiCTF-2023/" title="WriteUps for some problems in SekaiCTF-2023">WriteUps for some problems in SekaiCTF-2023</a><time datetime="2023-08-29T03:54:14.000Z" title="Created 2023-08-29 11:54:14">2023-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/19/CVE-2016-9793%E5%88%86%E6%9E%90/" title="CVE-2016-9793分析"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CVE-2016-9793分析"/></a><div class="content"><a class="title" href="/2023/04/19/CVE-2016-9793%E5%88%86%E6%9E%90/" title="CVE-2016-9793分析">CVE-2016-9793分析</a><time datetime="2023-04-19T08:27:13.000Z" title="Created 2023-04-19 16:27:13">2023-04-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/17/ucore-lab/" title="ucore-lab"><img src="https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ucore-lab"/></a><div class="content"><a class="title" href="/2023/04/17/ucore-lab/" title="ucore-lab">ucore-lab</a><time datetime="2023-04-17T07:04:17.000Z" title="Created 2023-04-17 15:04:17">2023-04-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2021/10/14/GSfj5BxXTdRqg2o.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Photon</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br>
<img src="https://static.dy208.cn/o_1dfilp8ruo521thr1hvf18ji17soa.png">
<a href="https://beian.miit.gov.cn/"  style="color:#f72b07" target="_blank">皖ICP备2022000759号</a></div><div class="footer_custom_text">欢迎来到光子的博客哟(●'◡'●)</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'J3nDf4qkr8OdRFaP64k2k453-gzGzoHsz',
      appKey: 'NXx6F7OYpwVWFbIQPVnw8HvN',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"live2d-widget-model-haruto"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>